import{_ as s,c as i,o as a,aj as n}from"./chunks/framework._AF764y6.js";const c=JSON.parse('{"title":"异地组网&内网穿透","description":"","frontmatter":{"title":"异地组网&内网穿透","date":"2023-10-26T21:33:53.000Z","permalink":"/zerotier/","categories":["运维"],"tags":["组网"],"author":"Manaphy"},"headers":[],"relativePath":"ops/其他/30.异地组网.md","filePath":"ops/其他/30.异地组网.md","lastUpdated":1743618064000}'),l={name:"ops/其他/30.异地组网.md"},e=n(`<h2 id="zerotier异地组网" tabindex="-1">zerotier异地组网 <a class="header-anchor" href="#zerotier异地组网" aria-label="Permalink to “zerotier异地组网”">​</a></h2><h3 id="在公网服务器部署zerotier-planet" tabindex="-1">在公网服务器部署zerotier-planet <a class="header-anchor" href="#在公网服务器部署zerotier-planet" aria-label="Permalink to “在公网服务器部署zerotier-planet”">​</a></h3><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">version</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;3.0&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">services</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    ztncui</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">        container_name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">ztncui</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">        restart</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">always</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">        environment</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">MYADDR=1.1.1.1</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> #改成自己的服务器公网IP</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">HTTP_PORT=4000</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">HTTP_ALL_INTERFACES=yes</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">ZTNCUI_PASSWD=123456</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> #登录密码</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">        ports</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;4000:4000&#39;</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> # web控制台入口</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;9993:9993&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;9993:9993/udp&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;3180:3180&#39;</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> # planet/moon文件在线下载入口，如不对外提供。可防火墙禁用此端口。</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">        volumes</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;./zerotier-one:/var/lib/zerotier-one&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;./ztncui/etc:/opt/key-networks/ztncui/etc&#39;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">            # 按实际路径挂载卷， 冒号前面是宿主机的， 支持相对路径</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">        image</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">keynetworks/ztncui</span></span></code></pre></div><h3 id="在客户端运行zerotier-one" tabindex="-1">在客户端运行zerotier-one <a class="header-anchor" href="#在客户端运行zerotier-one" aria-label="Permalink to “在客户端运行zerotier-one”">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -d</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">  --restart</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> unless-stopped</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">  --name</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> zerotier-one</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">  --device</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /dev/net/tun</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">  --net</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> host</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">  --cap-add</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> NET_ADMIN</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">  --cap-add</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> SYS_ADMIN</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">  -v</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /var/lib/zerotier-one:/var/lib/zerotier-one</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  henrist/zerotier-one</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 加入网络</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> exec</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -it</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> zerotier-one</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> zerotier-cli</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> join</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 4bc69f74e087e27c</span></span></code></pre></div><h3 id="zerotier-cli相关命令" tabindex="-1">zerotier-cli相关命令 <a class="header-anchor" href="#zerotier-cli相关命令" aria-label="Permalink to “zerotier-cli相关命令”">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 加入网络</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">zerotier-cli</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> join</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 4bc69f74e087e27c</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 退出网络</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">zerotier-cli</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> leave</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 8286ac0e4717da9e</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 查看ip</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">zerotier-cli</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> listnetworks</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 查看状态</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">zerotier-cli</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> status</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 查找当前你网络内的主机信息</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">zerotier-cli</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> listpeers</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 查询本机的zerotier节点地址</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">zerotier-cli</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> info</span></span></code></pre></div><h3 id="部署moon服务" tabindex="-1">部署moon服务 <a class="header-anchor" href="#部署moon服务" aria-label="Permalink to “部署moon服务”">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> pull</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> seedgou/zerotier-moon</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --name</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> zerotier-moon</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -d</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">	--restart</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> always</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 9993:9993/udp</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">	-v</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /home/zerotier-moon:/var/lib/zerotier-one</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">	seedgou/zerotier-moon</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -4</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 47.111.189.141</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 1.安装zerotier客户端到云服务器</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> https://install.zerotier.com</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> bash</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 2.加入自己的NETWORK ID</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">zerotier-cli</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> join</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 8286ac0e4717da9e</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 3.配置moon</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /var/lib/zerotier-one</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 4.生成 moon.json 配置文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">zerotier-idtool</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> initmoon</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> identity.public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> &gt;&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> moon.json</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 5.编辑 moon.json 配置文件</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> #将配置文件中的 &quot;stableEndpoints&quot;: [] 修改成 &quot;stableEndpoints&quot;: [&quot;ServerIP/9993&quot;]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 6.创建moon文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">zerotier-idtool</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> genmoon</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> moon.json</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 7. 新建moons.d文件将生成的000*****.moon文件移动进去</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">mkdir</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> moons.d</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">mv</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 000000xxxxxxxxxx.moon</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> moons.d</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 8.重启 zerotier-one 服务</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> zerotier-one</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 查询本机的zerotier节点地址</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">zerotier-cli</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> info</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 显示如下结果</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">200</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> info</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 579753c60c</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1.10.2</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ONLINE</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 加入moon的节点 579753c60c 服务器端的Address</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">zerotier-cli</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> orbit</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 579753c60c</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 579753c60c</span></span></code></pre></div><p>不同系统下的 ZeroTier 目录位置：</p><ul><li><strong>Linux</strong>: <code>/var/lib/zerotier-one</code></li><li><strong>FreeBSD</strong> / <strong>OpenBSD</strong>: <code>/var/db/zerotier-one</code></li><li><strong>Mac</strong>: <code>/Library/Application\\ Support/ZeroTier/One</code></li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ./zerotier-cli</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> orbit</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 579753c60c</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 579753c60c</span></span></code></pre></div><ul><li><strong>Windows</strong>: <code>C:\\ProgramData\\ZeroTier\\One</code></li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">zerotier-one_x64.exe</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -q</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> orbit</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 579753c60c</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 579753c60c</span></span></code></pre></div>`,16),h=[e];function t(p,k,r,d,F,o){return a(),i("div",null,h)}const y=s(l,[["render",t]]);export{c as __pageData,y as default};
