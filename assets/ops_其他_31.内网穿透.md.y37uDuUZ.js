import{_ as g}from"./chunks/ArticleMetadata.BPSr9oED.js";import{_ as y,E as F,c,o as n,j as l,I as t,aj as d,w as e,b as k,e as r,a as o}from"./chunks/framework._AF764y6.js";const w=JSON.parse('{"title":"内网穿透","description":"","frontmatter":{"title":"内网穿透","date":"2023-11-04T11:22:01.000Z","permalink":"/pages/e1a103/","categories":["运维"],"tags":[null],"author":"Manaphy"},"headers":[],"relativePath":"ops/其他/31.内网穿透.md","filePath":"ops/其他/31.内网穿透.md","lastUpdated":1743259133000}'),D={name:"ops/其他/31.内网穿透.md"},C=l("h1",{id:"lanproxy",tabindex:"-1"},[o("Lanproxy "),l("a",{class:"header-anchor",href:"#lanproxy","aria-label":"Permalink to “Lanproxy”"},"​")],-1),A=d(`<h2 id="准备" tabindex="-1">准备 <a class="header-anchor" href="#准备" aria-label="Permalink to “准备”">​</a></h2><ul><li>一台能访问公网的服务器(运行proxy-server)</li><li>一台内网服务器(运行proxy-client)</li></ul><h2 id="公网服务器搭建" tabindex="-1">公网服务器搭建 <a class="header-anchor" href="#公网服务器搭建" aria-label="Permalink to “公网服务器搭建”">​</a></h2><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">version</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;3.1&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">services</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  lanproxy-server</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    image</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">manaphychen/lanproxy-server</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    privileged</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">true</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    container_name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">lanproxy-server</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    restart</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">always</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    environment</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">LANPROXY_USERNAME=admin</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">  # 配置你的账号，默认admin</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">LANPROXY_PASSWORD=admin</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">  # 配置你的密码，默认admin</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    volumes</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">./config-data:/root/.lanproxy</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> # 用于保存创建的配置文件，避免重启服务后配置消失</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    network_mode</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">host</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">    #ports:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">    #  - 8090:8090 # web界面端口</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">    #  - 4900:4900</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">    #  - 4993:4993</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">    #  - 60001-60100:60001-60100</span></span></code></pre></div><p>注意: 以上端口都需要开放<br><code>docker-compose up -d</code>运行<br>访问 ip:8090 输入密码后配置客户端<br><img src="https://cdn.nlark.com/yuque/0/2021/png/2345482/1624607906283-34d43b8b-f778-4c4e-b322-273432b797d5.png" alt="image.png"></p><h2 id="内网服务器搭建" tabindex="-1">内网服务器搭建 <a class="header-anchor" href="#内网服务器搭建" aria-label="Permalink to “内网服务器搭建”">​</a></h2><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">version</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;3.1&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">services</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  lanproxy-client</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    image</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">manaphychen/lanproxy-client</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    container_name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">lanproxy-client</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    restart</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">always</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    privileged</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">true</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    environment</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">      LANPROXY_KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;xxxxxxxxxxxxxx&#39;</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> #客户端密钥</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">      LANPROXY_HOST</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;111.111.111.111&#39;</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> #公网服务器ip</span></span></code></pre></div><p>如果没有安装 docker-compose 可直接运行以下命令</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -d</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --name</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> lanproxy-client</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -e</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> LANPROXY_KEY=&quot;xxxxxxxxxxxxxx&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -e</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> LANPROXY_HOST=&quot;111.111.111.111&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --privileged=true</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --restart=always</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> manaphychen/lanproxy-client</span></span></code></pre></div><p>执行<code>docker-compose up -d</code>运行<br>在服务器搭建需要穿透的服务，如<br><img src="https://www.pnglog.com/xjb8aJ.png" alt="image.png"></p><h2 id="配置穿透" tabindex="-1">配置穿透 <a class="header-anchor" href="#配置穿透" aria-label="Permalink to “配置穿透”">​</a></h2><p>回到web界面 配置管理<br><img src="https://www.pnglog.com/rlmhtr.png" alt="image.png"></p><h1 id="nps" tabindex="-1">NPS <a class="header-anchor" href="#nps" aria-label="Permalink to “NPS”">​</a></h1>`,13),m=d(`<p>官网链接 <a href="https://ehang-io.github.io/nps/#/" target="_blank" rel="noreferrer">https://ehang-io.github.io/nps/#/</a></p><h2 id="服务器端" tabindex="-1">服务器端 <a class="header-anchor" href="#服务器端" aria-label="Permalink to “服务器端”">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">mkdir</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> nps</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> &amp;&amp; </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> nps</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">wget</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> https://github.com/ehang-io/nps/releases/download/v0.26.10/linux_amd64_server.tar.gz</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">tar</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> zxvf</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> linux_amd64_server.tar.gz</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">./nps</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> install</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">vim</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> conf/nps.conf</span></span></code></pre></div><p>修改一下几个参数</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#HTTP(S) proxy port, no startup if empty</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">http_proxy_ip</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">0.0.0.0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">http_proxy_port</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">80</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> #如果服务器已将该端口占用,则修改改端口或注释该行</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">https_proxy_port</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">443</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> #如果服务器已将该端口占用,则修改改端口或注释该行</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">https_just_proxy</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">true</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">##web</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">web_host</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> 111.111.111.111</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> #服务器IP或者域名</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">web_username</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> admin</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> #登录用户名</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">web_password</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> admin</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> #你的密码</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">web_port</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">8080</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> #web管理端口</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">##bridge</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">bridge_type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">tcp</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">bridge_port</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">443</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">  # 修改连接端口</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">bridge_ip</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">0.0.0.0</span></span></code></pre></div><p>客户端</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 非docker方式</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">mkdir</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> npc</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> &amp;&amp; </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> npc</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">wget</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> https://github.com/ehang-io/nps/releases/download/v0.26.10/linux_amd64_client.tar.gz</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">tar</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> zxvf</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> linux_amd64_client.tar.gz</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">nohup</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ./npc</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -server=111.111.111.111:8024</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -vkey=hzq64tdqv6l8zthl</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -type=tcp</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> &amp;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># docker的运行方式</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -d</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --name</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> npc</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --net=host</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --restart=always</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ffdfgdfg/npc:v0.26.10</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -server=111.111.111.111:8024</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -vkey=hzq64tdqv6l8zthl</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -type=tcp</span></span></code></pre></div>`,7);function _(s,b,B,u,x,v){const p=g,h=F("ClientOnly");return n(),c("div",null,[C,t(h,null,{default:e(()=>{var i,a;return[(((i=s.$frontmatter)==null?void 0:i.aside)??!0)&&(((a=s.$frontmatter)==null?void 0:a.showArticleMetadata)??!0)?(n(),k(p,{key:0,article:s.$frontmatter},null,8,["article"])):r("",!0)]}),_:1}),A,t(h,null,{default:e(()=>{var i,a;return[(((i=s.$frontmatter)==null?void 0:i.aside)??!0)&&(((a=s.$frontmatter)==null?void 0:a.showArticleMetadata)??!0)?(n(),k(p,{key:0,article:s.$frontmatter},null,8,["article"])):r("",!0)]}),_:1}),m])}const P=y(D,[["render",_]]);export{w as __pageData,P as default};
