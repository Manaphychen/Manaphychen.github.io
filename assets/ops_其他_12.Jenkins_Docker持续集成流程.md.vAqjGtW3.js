import{_ as s,c as i,o as a,aj as n}from"./chunks/framework._AF764y6.js";const l="/assets/image-20201209190435102.DC_yH1pX.png",h="/assets/image-20201209190904241.Dx1kXrTF.png",t="/assets/image-20201209191606156.B7X74aFH.png",p="/assets/image-20201209191902318.8k3E_Jiy.png",k="/assets/image-20201208192124705.CrES61hh.png",e="/assets/image-20201207202502055.D4hstxCZ.png",r="/assets/image-20201208182525527.0hua9z2I.png",d="/assets/image-20200819174745049.CePwy7ZI.png",g="/assets/image-20201208184013669.BvfFFJc6.png",o="/assets/image-20201208184235480.D475mbXG.png",A="/assets/1610517724469-0c883325-6fe9-48c9-b6ae-2ea51694e135.Cq4h0xwo.png",y="/assets/image-20201208185332371.BK2g1a6r.png",F="/assets/image-20201208190032443.DfOyFAyN.png",D="/assets/image-20201208190226122.Bwf64pSd.png",c="/assets/image-20201208190557524.fy1I5Bk1.png",C="/assets/image-20201209100716036.C_I_NUae.png",B="/assets/image-20201209100806739.D5iHssNP.png",b="/assets/image-20201208193743195.CT2199js.png",u="/assets/image-20201208194244974.8Y_e-h6A.png",m="/assets/image-20201208194404840.BfzEuB1r.png",E="/assets/image-20201208194940956.Dvawz2Tf.png",v="/assets/image-20201208195410397.CXqOAd3b.png",f="/assets/image-20201208195553286.DBdZJa9n.png",q="/assets/image-20201208200049990.DbqXQuN-.png",x="/assets/image-20201208201320469.B5_b2TSw.png",j="/assets/image-20201208202242697.GkRAkVrl.png",P="/assets/image-20201208202341036.K3GAAoMu.png",_="/assets/image-20201208202445833.lGZb9wwL.png",R="/assets/image-20201209115807931.C5R5qb6n.png",z="/assets/image-20201209133501836.BOox_Ddv.png",M="/assets/image-20201209133730269.YkqPYsow.png",S="/assets/image-20201209135553100.0sbpU7Xr.png",G="/assets/image-20201209141044560.z174yeYa.png",T="/assets/image-20201209184706225.zf_ANX9E.png",O="/assets/image-20201209185346039.DTNGff1S.png",J="/assets/image-20201209185303605.CNQpA5fC.png",H="/assets/image-20201210151608982.BQAF2enb.png",U="/assets/image-20201210153634996.B_CUdPw4.png",N="/assets/image-20201210153911180.CtpZTyoY.png",w="/assets/image-20201210161459791.DiH3j1HT.png",I="/assets/image-20201209194942039.CvvOjSPm.png",Q="/assets/image-20201209195213926.aWM28kMl.png",X="/assets/image-20201210162641681.Dt31-4R8.png",L="/assets/image-20201210163014243.CWRSVl96.png",V="/assets/image-20201210164406698.HKexvH5h.png",K="/assets/image-20201209200434905.R36r__8x.png",Y="/assets/image-20201209201027022.CKpvjYrK.png",Z="/assets/image-20201209202922139.ChZSJsz-.png",W="/assets/image-20201210165907257.2w8Oy8BF.png",$="/assets/image-20201210170252051._Wsrvn7p.png",ss="/assets/image-20201210170353903.ozx2oWjK.png",is="/assets/image-20201210171434461.0DJUQcni.png",as="/assets/image-20201210171647878.BmA-meq_.png",ns="/assets/image-20201210172458481.D-qt6f-6.png",ls="/assets/image-20201210172607131.DbRX9Kv9.png",hs="/assets/image-20201210172837415.C9QE8jt1.png",ts="/assets/image-20201210174512982.hTbdu-Qz.png",ps="/assets/image-20201210175953053.CJnPojkf.png",ks="/assets/image-20201210183137971.Dfe7uGxK.png",es="/assets/image-20201210183932199.CkGHtk0H.png",rs="/assets/image-20201210185050626.G7KxCRp8.png",ds="data:image/png;base64,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",gs="/assets/image-20201210193403775.DK2_ktL9.png",os="/assets/image-20201210193824544.CIbs6ztO.png",As="/assets/image-20201210194054997.vo54IZ1_.png",ys="/assets/image-20201210194208022.Cl037YHW.png",Fs="/assets/image-20201210201829517.Zy_hM1uv.png",Ds="/assets/image-20201211094603659.DgjDR6Ly.png",cs="/assets/image-20201211094717508.BJ-tHERE.png",Cs="data:image/png;base64,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",Bs="/assets/image-20201210202500577.DvQgu8lb.png",bs="/assets/image-20201211095910536.CVqk8Itj.png",us="data:image/png;base64,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",ms="data:image/png;base64,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",Es="/assets/image-20201211103738266.CnizgjWc.png",vs="/assets/image-20201211104854108.BoTUa_uW.png",fs="/assets/image-20201211105145467.kNNgL5Az.png",qs="/assets/image-20201211110541667.Dt5TQgEt.png",xs="/assets/image-20201211110913912.Dggr6aFB.png",js="/assets/image-20201211111229432.DW2v2Z2k.png",Ps="/assets/image-20201207202502055.D4hstxCZ.png",_s="/assets/image-20201207101929130.CKflKWOW.png",Rs="/assets/image-20201207204034308.CLSOCFg5.png",zs="/assets/image-20201211200206233.BD7vXaol.png",Ms="/assets/image-20201214105352661.BSTZJ0_I.png",Ss="/assets/image-20201214110256918.7KAZcVmU.png",Gs="data:image/png;base64,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",Ts="/assets/image-20201214113402525.CGBjqpkm.png",Os="/assets/image-20201214135442341.CK0-r1bk.png",Js="/assets/image-20201215202002811.DBlF1aL2.png",Hs="/assets/image-20201214171758347.3v_WTax9.png",Us="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAfQAAAHPCAMAAACStdjWAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAIHUExURf///+7u7uDg4DMzM8zMzP39/Zunr/n5+erv8hAQEM2OM+yxbmyu5ozK+fnKjOb5+azj+fnjrAtqovn55rDp/zNsrOz/////0TNtsDOOzTOR0W6x7P/Pj9GRM835+Y/P//7+/uaubNH//7CxrMrLxs7PyqxsM/n5zTMzjP/psGwzM///7DMzbLBtM2xsrI8zbjMzbqxsbIwzM48zM24zj4Zqoo8zjwtqqowzbDMzj+OzqgtqtaWAoguAwc7Ozt/f3/n54uP5+cSaoowzjG4zM/r6+guaz8T5+RgYGGwzbKXj+bBtbobM+WwzjPn5z+zs7M/Pz1paWm5tsKXjz4zKzc3KjKzKrGyOzVhqooyObPnjwd7e3tzc3PLy8mxsbOb55qxsjObjrLDp0c355sT54ubj5tH/7DORsG6xsM2ObKyOM4yurGyuzbCRM9HpsI/P0eaujAuatY/P7I+RjzNsbIxsrKyubIyOjIzK5ub5zeyxj4bMz7Cx7GyOrOvr66+4v+rq6mhoaPn6+2tra/7+/6yObOzpsG5tM+z/7G4zbo++sPnMtc2ubNH/0YyOM2yurOzPj+PMwViz4sSzqoyuzaXMwWxsMzOOrIaatVhqqoxsbI9tbliAooZqqrCRsKyujFizwTNtbs35zY+RbqzjzTNtj8T5z8TMtazj5m5tbubj+bCxjzORjwdWsvIAAAytSURBVHja7N35b9vmHYBxtm9c1pRIi5VsWRIphdomW7IlX4ERo4M9YDYaoyhyoE2W9UiToWvXK0Xbtd2w7u4u7Pph2IYN2LAL2PVH7j1Iim7gAAOy1Xr5PGjt2HFagB993/elKteOS6XLeZhKl/MwD/wSTjrXAHQCnUAn0Al0Ap1AJ9AJdAKdQKcHj+4U4pqUBf38Z/K/uCZlQf/0p/K/uCYs78TyTvYv7+FovVb40BN+/uuVbbH+R1HVn64Gwk9arnfii2lGl/f6wLDegy7JV7v1j0ZCtOQXrT4jnt5e/fP24gJXdKaX90AUWv3SoPBRVa4A+QeTrhv85i3xq9/V9J9g2Gd7eV/Z1oKJHGZTcsI0H/v0EbD46mo3HFW5prO9vHtqbZcLeRG3VWA2yTVdPhp8vf8HhU2fZvL0Ho5WuxI03anl1v1z8drIzzb7VvawkG/fN/5+wuo+66d3JZuu8WY59zJWOeqLC4k8y6mHRCDPcdI+fGFU9TjKzfzpXS/jfraht/Q2ru7LzCGvlc7/M+nxrj54ly3dgidnEn1WN3Mul3qFXh9ko68eEnqyE/VYkH+r0eeSzvqTM4lYv2kmOhCLP83v3jS/yPZ6tQusXx/JjwKRH/RpRpf3RKSn9/xI7n3scJ4tBJ7eBQLx+oDT+6w/OePnk5wu2950g0+fpXHdl9RXVtUbtex7LPCzvrxTCU/vVMbTO7G8k0XoBDqBTqAT6AQ6gU6gE+gEOoFOnwh6fVB4zVsg1mvhU/zncsvR64P8pe365a/qu9a4ZHajZ3Me6FfDhJOF/HtZeJ2zrejhyPfUq6MSY6zQzaB7vPrRVvTwuOaubLfS705L0hGvb7Gv2356X5l+93HwrnwUuBKdi2Y1upd9j6Jcz+sfTb721dvHf9/66zavcrYWPZh+R1Mg0d+6rvb0lpz0gFc5Wz3pU/RwcnuyILd5tbxzkCsJeuCHk1vyFk6hqyMelWFP17dsHORKNekGXf/vhbholt+yEegEOoFOoBPoBDqBTqAT6AQ6gU4PDv1g/xxZ2enoB89dfois7HT0/efdObKy09HPHZ13yM5OR5/j4oBOoBPoBDqBTqAT6DQL6M2NBlcOdLIJvdKuCNGWv4iEfh8tvyF+cijE8hLXzl500XHWxh0n2myY96LHpNs/6WrKl5fijnkfqREHvQTow2s/GvfU+wt90Ms26cNrTHop0OVe3tzpTfd00EuA/vJYiE56eu84Bl0e7zi92768E+gEOtmGTqAT6AQ6zTj6vsvFKR36wbNHXJ2yofNdqyX8rlXif0pAoBPoBDqBTqAT6AQ6gU6gE+gEOoFOoBPooBPoBDqBTqAT6AQ6gU6gE+gEOv2f0esDofLdcPJq1ZVvF9Rng1b2u758m7S4gnahb9XCG26i0G8NpHqy2i2gh0+9J9IWF7iM9qDffO3DF9/zsxl3k2oBXX/ApNs46R/+M3n/5DSnzCsXa67HoNu7pweKNRHCzLYxTtYluq/X+QnoVp3e5Z6uVnQJLPM0uqd39vD4BSbd6kn3hJ+jr1y8qT4IPthi0m2e9PrW9RsGvf5iN1i8rZHrW0y6jejhSJtWg8VbW2p9936xXVV353rA60y6rZPueh8MXpfO+siuVnmvpe7Qu0y6tehfuX5DjrFyrg+qhlkDq2dpmHQ70YOW3MNTUz3d2e2aUpcb/Sh7Rs4c7smW5Z1AJ9AJdAKdQCfQCXQCnUAn0Al0eoDo/AyX8v0Ml4PnLj9EVnafn8v2vDtHVnafn8B4dJ4fYMaP3STQCXQCnUAn0Al0Ap0+cfRYiLZ8VxFC7PWd5o7+sKK/z2F5iQtoJXosieOO+Vv29YazNja/XBv3uH5Wojc3Go4zvNB34qlwZCY8YtBtRpdvimNdaTPo9i/vlU2JLsRmwzwOdnoMut3oSvuVDc0dafXmjtnSYwbd6ls2tadr504mL+13+1w9m9HNJq6HO1/UozYXz2b04Y8bTvMb0nmvPz29pbdwZCN6xRzg1JMye329w+tPrD3Z4OJZvbwT6AQ6gU6gE+gEOoFOoBPoBDqBTqAT6AQ66KCDDjroBDqBTqAT6AQ6gU6gE+gEOoFOoBPoBDqBDjrooIMOOoFOoBPoBDqBTqAT6AQ6gU6gE+gEOoFOoBPooIMOOoFOoBPoBDqBTqAT6AQ6gU6gE+gEOoFOoBPooIMOOuigE+gEOoFOoBPoBDqBTqAT6AQ6gU6gE+gEOuj3tu9ycUqHfvDsEVenbOjuwf45srLT0R95lCwNdNBBB53Khk62dp/TO9ka6KAT6AQ6gU6gE+gEOoFOoBPoBDqBTqAT6AQ6gU6gg06gE+gEOoFOoBPoNDPonu+6KxdrbtBy3fpWzXyuGiwucNlsRg9HwrReC49rBv0l1O1FD6R1K590N33rVblm1i/vxZJ07EWL62YzupcyV+Xc+3r8mXTL0UVLuoeTBbWo1wcSPTz+NWNu+Z7uuyfR5WHOq3qc48qyvCv0cOQr/mS9xnWzGr0w6U/Lg7w+vXPPVh50n1u2si3vnmBVL8NBTiqnt+peNWjpZ2tMq10unK2TTqAT6AQ6gU6gE+gEOoFOoBPo9D9EP+InMJbu57IdOVeuXponGzsVfe4K5KVDd67Of+fbc2Rjp6Nfmv8mm1/J9nRHrgIEOoFOoBPoBDqBTmcbvdIz79rphx31trmTfuhUlpeyf1RFCNGpmJfG9/QX9fJ/zfCa/rLmRkN/dJi/hn76x+nsoEu6ylRobawg18ZvjzPQuJ2jt524ox8ca0821B9M/9RmwzxYmrt9ia5+b3ihf+9jhs7Q8m6G1Ex6pBDbyk27OvoB0LsHXQ308PAfe/3poqDEQZ+hPT2f2Y4TtbMP//b7VD3e6xeX9/baWD4uUveOE+uVXj9Y7u5kgw/62UaPzP6c7enx3d2f7RqxdH9ubvyw8/FJz3fyQ5E9IpyowAv6WZ/0+G426GLzjiKPzEHNHOkk2w9SQoOeHuQq6SlNLwt7b17oV9pxvseDfubRe9IynU917N78l1y0e3EvO8dnv52i/3tjuuHn0y0/ob+8aVYJ0GcB3YyoWqqb6aRn6Go5Txf6dE+Xn1fYUX5Xpk7vcSfObwLaoM/UpOtT3DuFSY/M/Zimk59Qe3pz4455EKQHez3dlZflrLebu18e9yqgzwD62394I5v0KH2TTfrwsDe9WY8NupzxTlFUo0d/Urs66DOCLu/AesVJl8u7mnQ92JHoZV+0vGR290p7ePiOVh8etgsb+/Bw8y9TdJ6RO+PPyMlBVeix2owN+is7mw25QffM2p7drb957Zf61K52/njzzo56r+7Z1QMjUrrmbi6Wjwgm/ew/OUOgE+gEOoFOoBPoBDqBTqAT6AQ6gU6gE+iggw466KAT6AQ6gU6gE+gEOoFOoBPoBDqBTqAT6AQ6gQ466KAT6AQ6gU6gE+gEOoFOoBPoBDqBTqAT6AQ6gQ466KBzcUAn0Al0Ap1AJ9AJdAKdQCfQCXQCnUAn0Al00EEHHXTQCXQCnUAn0Al0Ap1AJ9AJdAKdQCfQ6b9GvzR/matTNvSr899DvWToc1cuzZOdnYp+5Fy5CnvJ0N1vfff7rIMlW97dRx4lSwMddNBLjk62djo6WRvooBPoBDqVA31l21dvL9byzySr3eLvf7574uu/+IXHZL99TPf4E677uc8+/sR/2rFj1oSBKA7gww0HR4ya4JBFcNFSpFAhCFHBRsggNosKnTp16ejQofQjdGpLh0ILndqv2ffuLvGwDh178P+DicZM98u7vLv5dLzEUHuBHophS/YSeYAue53mb/T2qQjsJWY2BymzyQ19yepHAPnv6IQ7uGvKnjA52Qo3m5Hzg6pfBUZ89hKtylQzzy40+ndUZCD3B/22JVXiVLqRlWFi74n7oqp7i/50RdZlWkhZpgad8WnaLzDYfqDTpC0694suocf9hn0QGLhh71GbxTZw0R91iT+kRTZeEzoG2MNK58PAQY/PueTbZ3V105+2+u1J5qRdo8+nUZUVBtsT9PZlV7ro+qL9SudEN3IqOUD/WO/R7bs8A7ov6IOR07EZaZXE/cA27IHt3hWv4vbor2+Enk++KvScwIHu0fRuF2bcyNkXuRKVeSM0T8OwFdLibo++pB5ul0afFr1M6QrQvUQ3r3NawF2L5NjmjIvOx/fI9Ou8fOOOLkNb5wu62XRhdP0Z6TJXot6VO45O/RvP6IXZn9vpNj7HrpwvSzZb7Ypm8SR0rEf2FX+ITnVd8A4NV3U2XuZR9MxdHAcLdR/QeRv2r3G2YRGP0RGgI0BHgI4AHQE6AnQE6AjQEaAjQEeAjgAdATpyND/MlqC71Z0YXQAAAABJRU5ErkJggg==",Ns="/assets/image-20201215203312807.BLEz2oD2.png",ws="/assets/image-20201215204042123.ieb3V-XS.png",ii=JSON.parse('{"title":"Jenkins+Docker持续集成流程","description":"","frontmatter":{"title":"Jenkins+Docker持续集成流程","date":"2023-10-31T09:59:18.000Z","permalink":"/jenkins/","categories":["运维"],"tags":["jenkins"],"author":"Manaphy"},"headers":[],"relativePath":"ops/其他/12.Jenkins+Docker持续集成流程.md","filePath":"ops/其他/12.Jenkins+Docker持续集成流程.md","lastUpdated":1744301414000}'),Is={name:"ops/其他/12.Jenkins+Docker持续集成流程.md"},Qs=n('<h2 id="_1-持续集成及jenkins介绍" tabindex="-1">1. 持续集成及Jenkins介绍 <a class="header-anchor" href="#_1-持续集成及jenkins介绍" aria-label="Permalink to “1. 持续集成及Jenkins介绍”">​</a></h2><h3 id="_1-1-软件开发生命周期" tabindex="-1">1.1 软件开发生命周期 <a class="header-anchor" href="#_1-1-软件开发生命周期" aria-label="Permalink to “1.1 软件开发生命周期”">​</a></h3><p>软件开发生命周期又叫做<strong>SDLC</strong> ( Software Development Life Cycle )，它是集合了计划、开发、测试和部署过程的集合。如下图所示:<br><img src="'+l+'" alt=""></p><ul><li>需求分析<br>这是生命周期的第一阶段，根据项目需求，团队执行一个可行性计划的分析。项目需求可能是公司内部或者客户提出的。这阶段主要是对信息的收集，也有可能是对现有项目的改善和重新做一个新的项目。还要分析项目的预算多长，可以从哪方面受益及布局，这也是项目创建的目标。</li><li>设计<br>第二阶段就是设计阶段，系统架构和满意状态（就是要做成什么样子，有什么功能），和创建一个项目计划。计划可以使用图表，布局设计或者文者的方式呈现。</li><li>实现<br>第三阶段就是实现阶段，项目经理创建和分配工作给开者，开发者根据任务和在设计阶段定义的目标进行开发代码。依据项目的大小和复杂程度，可以需要数月或更长时间才能完成。</li><li>测试<br>测试人员进行代码测试，包括功能测试、代码测试、压力测试等。</li><li>进化<br>最后进阶段就是对产品不断的进化改进和维护阶段，根据用户的使用情况，可能需要对某功能进行修改，bug修复，功能增加等。</li></ul><h3 id="_1-2-软件的敏捷开发" tabindex="-1">1.2 软件的敏捷开发 <a class="header-anchor" href="#_1-2-软件的敏捷开发" aria-label="Permalink to “1.2 软件的敏捷开发”">​</a></h3><blockquote><p>敏捷开发(Agile Development)的核心是迭代开发( lterative Development)与增量开发( lncremental Development ) .</p></blockquote><p><strong>何为迭代开发?</strong><br>对于大型软件项目，传统的开发方式是采用一个大周期(比如一年)进行开发，整个过程就是一次&quot;大开发&quot;; 迭代开发的方式则不一样，它将开发过程拆分成多个小周期，即一次&quot;大开发&quot;变成多次&quot;小开发&quot;，每次小开发都是同样的流程，所以看上去就好像重复在做同样的步骤。<br>举例来说，SpaceX公司想造一个大推力火箭，将人类送到火星。但是，它不是一开始就造大火箭，而是先造一个最简陋的小火箭Falcon 1。结果，第一次发射就爆炸了，直到第四次发射，才成功进入轨道。然后，开发了中型火箭Falcon 9，九年中发射了70次。最后，才开发Falcon重型火箭。如果SpaceX不采用迭代开发，它可能直到现在还无法上天。</p><p><strong>何为增量开发?</strong><br>软件的每个版本，都会新增一个用户可以感知的完整功能。也就是说，按照新增功能来划分迭代。<br>举例来说，房产公司开发一个10栋楼的小区。如果采用增量开发的模式，该公司第一个迭代就是交付一号楼，第二个迭代交付二号楼......每个迭代都是完成一栋完整的楼。而不是第一个迭代挖好10栋楼的地基，第二个迭代建好每栋楼的骨架，第三个迭代架设屋顶…..</p><p><strong>敏捷开发如何迭代?</strong><br>虽然敏捷开发将软件开发分成多个迭代，但是也要求，每次迭代都是一个完整的软件开发周期，必须按照软件工程的方法论，进行正规的流程管理。</p><p><img src="'+h+'" alt=""></p><h3 id="_1-3-什么是持续集成" tabindex="-1">1.3 什么是持续集成 <a class="header-anchor" href="#_1-3-什么是持续集成" aria-label="Permalink to “1.3 什么是持续集成”">​</a></h3><blockquote><p>持续集成(Continuous integration，简称CI)指的是，频繁地(一天多次）将代码集成到主干。 **持续集成的目的，就是让产品可以快速迭代，同时还能保持高质量。**它的核心措施是，代码集成到主干之前，必须通过自动化测试。只要有一个测试用例失败，就不能集成。<br>通过持续集成，团队可以快速的从一个功能到另一个功能，简而言之，敏捷软件开发很大一部分都要归功于持续集成。</p></blockquote><p>持续集成的流程</p><p><img src="'+t+'" alt=""></p><p>根据持续集成的设计，代码从提交到生产，整个过程有以下几步</p><ul><li>提交<br>流程的第一步，是开发者向代码仓库提交代码。所有后面的步骤都始于本地代码的一次提交( commit )。</li><li>测试（第一轮)<br>代码仓库对commit操作配置了钩子( hook )，只要提交代码或者合并进主干，就会跑自动化测试。</li><li>构建<br>通过第一轮测试，代码就可以合并进主干，就算可以交付了。<br>交付后，就先进行构建( build )，再进入第二轮测试。所谓构建，指的是将源码转换为可以运行的实际代码，比如安装依赖，配置各种资源（样式表、JS脚本、图片)等等。</li><li>测试（第二轮)<br>构建完成，就要进行第二轮测试。如果第一轮已经涵盖了所有测试内容，第二轮可以省略，当然，这时构建步骤也要移到第一轮测试前面。</li><li>部署<br>过了第二轮测试，当前代码就是一个可以直接部署的版本( artifact )。将这个版本的所有文件打包(tar filename.tar *)存档，发到生产服务器。</li><li>回滚<br>一旦当前版本发生问题，就要回滚到上一个版本的构建结果。最简单的做法就是修改一下符号链接，指向上一个版本的目录。</li></ul><h3 id="_1-4-持续集成的组成要素" tabindex="-1">1.4 持续集成的组成要素 <a class="header-anchor" href="#_1-4-持续集成的组成要素" aria-label="Permalink to “1.4 持续集成的组成要素”">​</a></h3><ul><li>一个自动构建过程，从检出代码、编译构建、运行测试、结果记录、测试统计等都是自动完成的，无需人工干预。</li><li>一个代码存储库，即需要版本控制软件来保障代码的可维护性，同时作为构建过程的素材库，一般使用SVN或Git。</li><li>一个持续集成服务器，Jenkins就是一个配置简单和使用方便的持续集成服务器。</li></ul><p><img src="'+p+'" alt=""></p><h3 id="_1-5-持续集成的好处" tabindex="-1">1.5 持续集成的好处 <a class="header-anchor" href="#_1-5-持续集成的好处" aria-label="Permalink to “1.5 持续集成的好处”">​</a></h3><ol><li>降低风险，由于持续集成不断去构建，编译和测试，可以很早期发现问题，所以修复的代价就少</li><li>对系统健康持续检查，减少发布风险带来的问题</li><li>减少重复性工作</li><li>持续部署，提供可部署单元包</li><li>持续交付可供使用的版本</li><li>增强团队信心</li></ol><h3 id="_1-6-jenkins介绍" tabindex="-1">1.6 Jenkins介绍 <a class="header-anchor" href="#_1-6-jenkins介绍" aria-label="Permalink to “1.6 Jenkins介绍”">​</a></h3><p><img src="'+k+'" alt=""></p><blockquote><p>Jenkins 是一款流行的开源持续集成(Continuous Integration )工具，广泛用于项目开发，具有自动化构建、测试和部署等功能。官网: <a href="http://jenkins-ci.org/" target="_blank" rel="noreferrer">http://jenkins-ci.org/</a></p></blockquote><p>Jenkins的特征︰</p><ul><li>开源的Java语言开发持续集成工具，支持持续集成，持续部署。</li><li>易于安装部署配置∶可通过yum安装,或下载war包以及通过docker容器等快速实现安装部署，可方便web界面配置管理。</li><li>消息通知及测试报告︰集成RSS/E-mail通过RSS发布构建结果或当构建完成时通过e-mail通知，生成JUnit/TestNG测试报告。</li><li>分布式构建:支持Jenkins能够让多台计算机一起构建/测试。</li><li>文件识别:Jenkins能够跟踪哪次构建生成哪些jar，哪次构建使用哪个版本的jar等。</li><li>丰富的插件支持∶支持扩展插件，你可以开发适合自己团队使用的工具，如git , svn , maven ,docker等。</li></ul><h2 id="_2-jenkins安装和持续集成环境配置" tabindex="-1">2. Jenkins安装和持续集成环境配置 <a class="header-anchor" href="#_2-jenkins安装和持续集成环境配置" aria-label="Permalink to “2. Jenkins安装和持续集成环境配置”">​</a></h2><h3 id="_2-1-持续集成流程说明" tabindex="-1">2.1 持续集成流程说明 <a class="header-anchor" href="#_2-1-持续集成流程说明" aria-label="Permalink to “2.1 持续集成流程说明”">​</a></h3><p><img src="'+e+'" alt=""></p><ol><li>首先，开发人员每天进行代码提交，提交到Git仓库</li><li>然后，Jenkins作为持续集成工具，使用Git工具到Git仓库拉取代码到集成服务器，再配合JDK，Maven等软件完成代码编译，代码测试与审查，测试，打包等工作，在这个过程中每一步出错，都重新再执行一次整个流程。</li><li>最后，Jenkins把生成的jar或war包分发到测试服务器或者生产服务器，测试人员或用户就可以访问应用。</li></ol><h3 id="_2-2-gitlab代码托管服务器安装" tabindex="-1">2.2 GitLab代码托管服务器安装 <a class="header-anchor" href="#_2-2-gitlab代码托管服务器安装" aria-label="Permalink to “2.2 GitLab代码托管服务器安装”">​</a></h3><p><img src="'+r+`" alt=""></p><p>官网: <a href="https://about.gitlab.com/" target="_blank" rel="noreferrer">https://about.gitlab.com/</a></p><p>GitLab是一个用于仓库管理系统的开源项目，使用Git作为代码管理工具，并在此基础上搭建起来的web服务。</p><p>GitLab和GitHub一样属于第三方基于Git开发的作品，免费且开源（基于MIT协议），与Github类似，可以注册用户，任意提交你的代码，添加SSHKey等等。不同的是，<strong>GitLab是可以部署到自己的服务器上，数据库等一切信息都掌握在自己手上，适合团队内部协作开发</strong>，你总不可能把团队内部的智慧总放在别人的服务器上吧?简单来说可把GitLab看作个人版的GitHub。</p><h4 id="_2-2-1-gitlab安装" tabindex="-1">2.2.1 Gitlab安装 <a class="header-anchor" href="#_2-2-1-gitlab安装" aria-label="Permalink to “2.2.1 Gitlab安装”">​</a></h4><p><strong>docker-compose.yml 文件</strong></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">version:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;3&#39;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">services:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  gitlab:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    image:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;gitlab/gitlab-ce&#39;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    restart:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> always</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    container_name:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> gitlab</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    hostname:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;192.168.2.136:8880&#39;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    environment:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">      TZ:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;Asia/Shanghai&#39;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">      GITLAB_OMNIBUS_CONFIG:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> |</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">        external_url</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;http://192.168.2.136:8880&#39;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">        gitlab_rails[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;gitlab_shell_ssh_port&#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">]</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2222</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">        # unicorn[&#39;port&#39;] = 8888</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">        nginx[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;listen_port&#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">]</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 80</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    ports:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">      -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;8880:80&#39;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">      -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;4443:443&#39;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">      -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;2222:22&#39;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    volumes:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">      -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /etc/localtime:/etc/localtime</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">      -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ./config:/etc/gitlab</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">      -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ./data:/var/opt/gitlab</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">      -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ./logs:/var/log/gitlab</span></span></code></pre></div><p>执行<code>docker-compose up -d</code>运行容器</p><p>需要一定的部署时间请耐心等待</p><h4 id="_2-2-2-配置gitlab帐号密码" tabindex="-1">2.2.2 配置Gitlab帐号密码 <a class="header-anchor" href="#_2-2-2-配置gitlab帐号密码" aria-label="Permalink to “2.2.2 配置Gitlab帐号密码”">​</a></h4><p>访问<a href="http://192.168.2.136:8880" target="_blank" rel="noreferrer">http://192.168.2.136:8880</a> 并设置好密码<br><img src="`+d+'" alt=""></p><p>使用 root 帐号加刚才设置的密码登录<br><img src="https://gitee.com/manaphy/imageUpload/raw/master/img/image-20200819174925545.png" alt=""></p><h4 id="_2-2-3-gitlab添加组、创建用户、创建项目" tabindex="-1">2.2.3 Gitlab添加组、创建用户、创建项目 <a class="header-anchor" href="#_2-2-3-gitlab添加组、创建用户、创建项目" aria-label="Permalink to “2.2.3 Gitlab添加组、创建用户、创建项目”">​</a></h4><ol><li>创建组<br>使用管理员root创建组，一个组里面可以有多个项目分支，可以将开发添加到组里面进行设置权限，不同的组就是公司不同的开发项目或者服务模块，不同的组添加不同的开发即可实现对开发设置权限的管理</li></ol><p><img src="'+g+'" alt=""></p><ol start="2"><li>创建用户</li></ol><p><img src="'+o+'" alt=""></p><ol start="3"><li>将用户添加到组中</li></ol><p><img src="'+A+'" alt=""></p><ol start="4"><li>在用户组中创建项目<br>以刚才创建的新用户身份登录到Gitlab，然后在用户组中创建新的项目<br><img src="'+y+'" alt=""></li></ol><h3 id="_2-3-源码上传到gitlab仓库" tabindex="-1">2.3 源码上传到Gitlab仓库 <a class="header-anchor" href="#_2-3-源码上传到gitlab仓库" aria-label="Permalink to “2.3 源码上传到Gitlab仓库”">​</a></h3><ol><li>准备要上传的springboot项目</li><li>开启版本控制 选择<code>Git</code></li></ol><p><img src="'+F+'" alt=""></p><ol start="3"><li>提交代码到本地仓库 <code>Git→提交</code></li></ol><p><img src="'+D+'" alt=""></p><ol start="4"><li>推送到Gitlab项目仓库中 <code>Git→推送</code></li></ol><p><img src="'+c+`" alt=""></p><h3 id="_2-4-jenkins安装" tabindex="-1">2.4 Jenkins安装 <a class="header-anchor" href="#_2-4-jenkins安装" aria-label="Permalink to “2.4 Jenkins安装”">​</a></h3><p><strong>docker-compose.yml 文件</strong></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">version</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;3.1&#39;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">services</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  jenkins</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    image</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">jenkins/jenkins:lts</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    volumes</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">/root/docker/jenkins/data/:/var/jenkins_home</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> #此处的/root/docker/jenkins/data/ 可自定义</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">/var/run/docker.sock:/var/run/docker.sock</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">/usr/bin/docker:/usr/bin/docker</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">/usr/lib/x86_64-linux-gnu/libltdl.so.7:/usr/lib/x86_64-linux-gnu/libltdl.so.7</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    ports</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;8080:8080&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    expose</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;8080&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;50000&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    privileged</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">true</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    user</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">root</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    restart</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">always</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    container_name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">jenkins</span></span></code></pre></div><p>访问<a href="http://192.168.2.136:8080" target="_blank" rel="noreferrer">http://192.168.2.136:8080</a><br>获取并输入admin账户密码</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /root/docker/jenkins/data/secrets/initialAdminPassword</span></span></code></pre></div><p>输入后点<code>安装推荐的插件</code><br>按照提示添加管理员帐户并进入Jenkins后台</p><h3 id="_2-5-全局工具配置" tabindex="-1">2.5 全局工具配置 <a class="header-anchor" href="#_2-5-全局工具配置" aria-label="Permalink to “2.5 全局工具配置”">​</a></h3><p>在<code>系统管理→全局工具配置</code><br><strong>配置JDK</strong><br><img src="`+C+'" alt=""></p><p><strong>配置Git</strong><br><img src="'+B+'" alt=""></p><h3 id="_2-6-用户权限管理" tabindex="-1">2.6 用户权限管理 <a class="header-anchor" href="#_2-6-用户权限管理" aria-label="Permalink to “2.6 用户权限管理”">​</a></h3><blockquote><p>利用Role-based Authorization Strategy插件来管理Jenkins用户权限</p></blockquote><p><strong>安装 Role-based Authorization Strategy 插件</strong><br><img src="'+b+'" alt=""></p><p><strong>开启权限全局安全配置</strong><br>进入<code>系统管理→全局安全配置</code> 授权策略切换为 <code>Role_Based Strategy</code> 保存<br><img src="'+u+'" alt=""></p><h4 id="_2-6-1-创建角色" tabindex="-1">2.6.1 创建角色 <a class="header-anchor" href="#_2-6-1-创建角色" aria-label="Permalink to “2.6.1 创建角色”">​</a></h4><p>在<code>系统管理→Manage and Assign Roles</code><br><img src="'+m+'" alt=""></p><p><img src="'+E+'" alt=""></p><ul><li>Global roles(全局角色）︰管理员等高级用户可以创建基于全局的角色</li><li>Item roles (项目角色）∶针对某个或者某些项目的角色</li><li>Node roles(节点角色)︰节点相关的权限</li></ul><p>我们添加以下三个角色</p><ul><li>baseRole : 该角色为全局角色。这个角色需要绑定 Overall 下面的<code>Read</code>权限，是为了给所有用户绑定最基本的Jenkins访问权限。注意:如果不给后续用户绑定这个角色，会报错误∶用户名is missing the Overall/Read permission</li><li>role1:该角色为项目角色。使用正则表达式绑定<code>chen.*</code>，意思是只能操作<code>chen</code>开头的项目。</li><li>role2:该角色也为项目角色。绑定<code>chengp.*</code>，意思是只能操作<code>chengp</code>开头的项目。</li></ul><p><img src="'+v+'" alt=""><br>保存</p><h4 id="_2-6-2-创建用户" tabindex="-1">2.6.2 创建用户 <a class="header-anchor" href="#_2-6-2-创建用户" aria-label="Permalink to “2.6.2 创建用户”">​</a></h4><p>在<code>系统管理→管理用户</code><br><img src="'+f+'" alt=""></p><h4 id="_2-6-3-给用户分配角色" tabindex="-1">2.6.3 给用户分配角色 <a class="header-anchor" href="#_2-6-3-给用户分配角色" aria-label="Permalink to “2.6.3 给用户分配角色”">​</a></h4><p>在<code>系统管理→Manage and Assign Roles</code> 点击<code>Assign Roles</code><br>绑定规则如下:</p><ul><li>jack用户分别绑定baseRole和role1角色</li><li>smith用户分别绑定baseRole和role2角色</li></ul><p><img src="'+q+'" alt=""><br>保存</p><h4 id="_2-6-4-创建项目测试权限" tabindex="-1">2.6.4 创建项目测试权限 <a class="header-anchor" href="#_2-6-4-创建项目测试权限" aria-label="Permalink to “2.6.4 创建项目测试权限”">​</a></h4><p>待定</p><h3 id="_2-7-凭证管理" tabindex="-1">2.7 凭证管理 <a class="header-anchor" href="#_2-7-凭证管理" aria-label="Permalink to “2.7 凭证管理”">​</a></h3><p>凭据可以用来存储需要密文保护的数据库密码、Gitlab密码信息、Docker私有仓库密码等，以便Jenkins可以和这些第三方的应用进行交互。<br><strong>安装Credentials Binding Plugin插件(已在推荐的插件列表中)</strong><br>在<code>系统管理→Manage Credentials</code><br><img src="'+x+'" alt=""></p><ul><li>Username with password: 用户名和密码</li><li>GitHub App: 新加的凭证，具体功能我也不知道</li><li>SSH Username with private key: 使用SSH用户和密钥</li><li>Secret file :需要保密的文本文件，使用时Jenkins会将文件复制到一个临时目录中，再将文件路径设置到一个变量中，等构建结束后，所复制的Secret file就会被删除。</li><li>Secret text:需要保存的一个加密的文本串，如钉钉机器人或Github的api token</li><li>Certificate :通过上传证书文件的方式</li></ul><p>常用的凭证类型有: Username with password(用户密码）和 SSH Username with private key ( SSH密钥)<br>接下来以使用Git工具到Gitlab拉取项目源码为例，演示Jenkins如何管理Gitlab的凭证<br>前置: 需要有Git插件</p><h4 id="_2-7-1-用户密码类型" tabindex="-1">2.7.1 用户密码类型 <a class="header-anchor" href="#_2-7-1-用户密码类型" aria-label="Permalink to “2.7.1 用户密码类型”">​</a></h4><ol><li>创建凭证<br><code>全局凭据 (unrestricted)→添加凭据</code><br>选择&quot;Username with password&quot;，输入Gitlab的用户名和密码，点击&quot;确定&quot;。</li></ol><p><img src="'+j+'" alt=""></p><p><img src="'+P+'" alt=""></p><ol start="2"><li>测试凭证是否可用<br>构建一个自由风格的软件项目<br><img src="'+_+`" alt=""><br>查看<code>/root/docker/jenkins/data/workspace/test01/</code>目录<br>发现已经从Gitlab成功拉取了代码到Jenkins中</li></ol><h4 id="_2-7-2-ssh密钥类型" tabindex="-1">2.7.2 SSH密钥类型 <a class="header-anchor" href="#_2-7-2-ssh密钥类型" aria-label="Permalink to “2.7.2 SSH密钥类型”">​</a></h4><ol><li>使用root账户生成公钥和私钥</li></ol><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[root@localhost </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]# ssh-keygen -t rsa</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Generating</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> public/private</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> rsa</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> key</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> pair.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Enter</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> file</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> in</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> which</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> save</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> key</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (/root/.ssh/id_rsa):</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Created</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> directory</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;/root/.ssh&#39;.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Enter</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> passphrase</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (empty </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">for</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> no</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> passphrase</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">):</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Enter</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> same</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> passphrase</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> again:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Your</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> identification</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> has</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> been</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> saved</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> in</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /root/.ssh/id_rsa.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Your</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> public</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> key</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> has</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> been</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> saved</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> in</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /root/.ssh/id_rsa.pub.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">The</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> key</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> fingerprint</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> is:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">SHA256:3Iwb4dFvwZ2Dc+q3vrvVu49ks3mdkesDZgiiimJMT+A</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> root@localhost.localdomain</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">The</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> key&#39;s randomart image is:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">+---[RSA 2048]----+</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">|                 |</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">|         . . o . |</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">|        o . = =  |</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">| .     + B . = . |</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">|. .   . S + =   .|</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">| E . .   o + + o.|</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">|o + .   .   + * B|</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">|.+ o         + @+|</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">|o            .@O=|</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">+----[SHA256]-----+</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">[root@localhost ~]# cd /root/.ssh</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">[root@localhost .ssh]# ll</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">total 8</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-rw-------. 1 root root 1675 Dec  9 11:51 id_rsa</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-rw-r--r--. 1 root root  408 Dec  9 11:51 id_rsa.pub</span></span></code></pre></div><ul><li>id_rsa: 私钥文件</li><li>id_rsa.pub: 公钥文件</li></ul><ol start="2"><li>把生成的公钥放在Gitlab中<br>以root账户登录→点击头像→设置→SSH密钥<br>复制<code>id_rsa.pub</code>文件的内容到这里，点击添加密钥<br><img src="`+R+'" alt=""></li><li>在Jenkins中添加凭证，配置私钥<br>在Jenkins添加一个新的凭证，类型为<code>SSH Username with private key</code>，并复制私钥文件内容到此处<br><img src="'+z+'" alt=""></li></ol><p><img src="'+M+'" alt=""></p><ol start="4"><li>测试凭证是否可用<br>新建test02项目→源码管理→Git，这次使用Gitlab的SSH连接，并且选择SSH凭证<br><img src="'+S+'" alt=""><br>同样尝试构建项目，如果代码可以正常拉取，代表凭证配置成功</li></ol><h3 id="_2-8-maven安装和配置一-自动安装" tabindex="-1">2.8 Maven安装和配置一(自动安装) <a class="header-anchor" href="#_2-8-maven安装和配置一-自动安装" aria-label="Permalink to “2.8 Maven安装和配置一(自动安装)”">​</a></h3><p>在Jenkins集成服务器上，我们需要安装Maven来编译和打包项目。<br>在<strong>插件管理</strong>安装<code>Maven Integration</code>插件<br><img src="'+G+'" alt=""></p><p>在<code>系统管理→全局工具配置</code>中配置Maven<br><img src="'+T+'" alt=""></p><p><strong>测试Maven是否可用</strong><br>修改test02项目，在构建中选<code>调用顶层Maven目标</code><br><img src="'+O+'" alt=""></p><p><img src="'+J+`" alt=""><br>执行构建后查看控制台信息就能看到Jenkins自动下载Maven，进行构建</p><p><strong>Maven配置阿里镜像</strong><br>进入<code>/root/docker/jenkins/data/tools/hudson.tasks.Maven_MavenInstallation/maven/conf/</code>目录，编辑<code>settings.xml</code>文件<br>在<code>pluginGroups</code>和<code>mirrors</code>标签中添加</p><div class="language-xml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">pluginGroups</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">pluginGroup</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;com.spotify&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">pluginGroup</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">pluginGroups</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">mirror</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">id</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;alimaven&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">id</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;aliyun maven&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">url</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;https://maven.aliyun.com/nexus/content/groups/public&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">url</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">mirrorOf</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;central&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">mirrorOf</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">mirror</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span></code></pre></div><h3 id="_2-9-maven安装和配置二-手动安装" tabindex="-1">2.9 Maven安装和配置二(手动安装) <a class="header-anchor" href="#_2-9-maven安装和配置二-手动安装" aria-label="Permalink to “2.9 Maven安装和配置二(手动安装)”">​</a></h3><blockquote><p>该方式可直接执行Shell命令</p></blockquote><h4 id="_2-9-1-安装maven" tabindex="-1">2.9.1 安装Maven <a class="header-anchor" href="#_2-9-1-安装maven" aria-label="Permalink to “2.9.1 安装Maven”">​</a></h4><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 进入Jenkins容器</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> exec</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -it</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> jenkins</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> bash</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 将自动安装的maven复制到 /usr/local 目录</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">cp</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -r</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /var/jenkins_home/tools/hudson.tasks.Maven_MavenInstallation/Maven</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /usr/local/</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># Ctrl+D退出容器 将容器内的profile文件复制到本机</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> cp</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> jenkins:/etc/profile</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ./</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 编辑profile文件,添加环境变量</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> JAVA_HOME</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">/var/jenkins_home/tools/hudson.model.JDK/jdk8</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> MAVEN_HOME</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">/usr/local/maven</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> PATH</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">$PATH:$JAVA_HOME/bin:$MAVEN_HOME/bin</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 将文件复制回容器</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> cp</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> profile</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> jenkins:/etc/</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 重新进入容器</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> exec</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -it</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> jenkins</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> bash</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 使配置生效</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">source</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /etc/profile</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 查看maven版本</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">mvn</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -v</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 出现如下内容</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Apache</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Maven</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 3.6.3</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (cecedd343002696d0abb50b32b541b8a6ba2883f)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Maven</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> home:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /usr/local/maven</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Java</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> version:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 1.8.0_242,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> vendor:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Oracle</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Corporation,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> runtime:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /usr/local/openjdk-8/jre</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Default</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> locale:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> en,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> platform</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> encoding:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> UTF-8</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">OS</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> name:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;linux&quot;,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> version:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;3.10.0-1160.6.1.el7.x86_64&quot;,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> arch:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;amd64&quot;,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> family:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;unix&quot;</span></span></code></pre></div><h4 id="_2-9-2-全局工具配置关联maven" tabindex="-1">2.9.2 全局工具配置关联Maven <a class="header-anchor" href="#_2-9-2-全局工具配置关联maven" aria-label="Permalink to “2.9.2 全局工具配置关联Maven”">​</a></h4><p>在<code>全局工具中配置</code>中新增Maven配置<br><img src="`+H+'" alt=""></p><h4 id="_2-9-3-添加jenkins全局变量" tabindex="-1">2.9.3 添加Jenkins全局变量 <a class="header-anchor" href="#_2-9-3-添加jenkins全局变量" aria-label="Permalink to “2.9.3 添加Jenkins全局变量”">​</a></h4><p>在<code>系统管理→系统配置→全局属性</code>中，添加<strong>M2_HOME</strong>和<strong>PATH+EXTRA</strong>两个属性<br><img src="'+U+'" alt=""></p><h4 id="_2-9-4-测试是否配置成功" tabindex="-1">2.9.4 测试是否配置成功 <a class="header-anchor" href="#_2-9-4-测试是否配置成功" aria-label="Permalink to “2.9.4 测试是否配置成功”">​</a></h4><p>新建<code>test-mvn</code>项目 在<code>配置→构建</code>的<code>执行Shell</code>中添加<code>mvn -v</code> 保存后点构建<br><img src="'+N+`" alt=""></p><h3 id="_2-10-tomcat安装和配置" tabindex="-1">2.10 Tomcat安装和配置 <a class="header-anchor" href="#_2-10-tomcat安装和配置" aria-label="Permalink to “2.10 Tomcat安装和配置”">​</a></h3><p>在生产部署服务器部署Tomcat 部署完后访问主页<br><a href="http://192.168.2.137:8080/" target="_blank" rel="noreferrer">http://192.168.2.137:8080/</a></p><h4 id="_2-10-1-配置tomcat用户角色权限" tabindex="-1">2.10.1 配置Tomcat用户角色权限 <a class="header-anchor" href="#_2-10-1-配置tomcat用户角色权限" aria-label="Permalink to “2.10.1 配置Tomcat用户角色权限”">​</a></h4><p>后续Jenkins部署项目到Tomcat服务器需要用到Tomcat的用户<br>编辑tomcat目录下<code>conf/tomcat-users.xml</code>文件，添加用户及权限 在<code>tomcat-users</code>标签中添加</p><div class="language-xml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">role</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;"> rolename</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;tomcat&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">role</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;"> rolename</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;role1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">role</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;"> rolename</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;manager-script&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">role</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;"> rolename</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;manager-gui&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">role</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;"> rolename</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;manager-status&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">role</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;"> rolename</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;admin-gui&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">role</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;"> rolename</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;admin-script&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">user</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;"> username</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;tomcat&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;"> password</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;tomcat&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;"> roles</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;manager-gui,manager-script,tomcat,admin-gui,admin-script&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">/&gt;</span></span></code></pre></div><p>用户名和密码都是:tomcat<br>为了能够刚才配置的用户登录到Tomcat，还需要修改以下配置<br>修改tomcat目录下<code>/webapps/manager/META-INF/context.xml</code>文件<br>注释掉以下代码</p><div class="language-xml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">&lt;!--</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">  &lt;Valve className=&quot;org.apache.catalina.valves.RemoteAddrValve&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">         allow=&quot;127\\.\\d+\\.\\d+\\.\\d+|::1|0:0:0:0:0:0:0:1&quot; /&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">  --&gt;</span></span></code></pre></div><p>重启Tomcat 访问测试<br><img src="`+w+'" alt=""></p><h4 id="_2-10-2-jenkins构建maven项目" tabindex="-1">2.10.2 Jenkins构建Maven项目 <a class="header-anchor" href="#_2-10-2-jenkins构建maven项目" aria-label="Permalink to “2.10.2 Jenkins构建Maven项目”">​</a></h4><ol><li>需要<code>Maven Integration</code>插件，已在前文安装</li><li>创建Maven项目<br><img src="'+I+'" alt=""></li><li>配置项目<br>拉取代码和前文自由风格项目一样，只是<strong>构建</strong>部分不同</li></ol><p><img src="'+Q+'" alt=""></p><h4 id="_2-10-3-将项目部署到远程tomcat" tabindex="-1">2.10.3 将项目部署到远程Tomcat <a class="header-anchor" href="#_2-10-3-将项目部署到远程tomcat" aria-label="Permalink to “2.10.3 将项目部署到远程Tomcat”">​</a></h4><ol><li>安装<code>Deploy to container</code>插件<br>Jenkins本身无法实现远程部署到Tomcat的功能，需要安装Deploy to container插件实现  (过程略...)</li><li>添加Tomcat用户凭证<br><img src="'+X+'" alt=""></li><li>添加构建后操作</li></ol><p><img src="'+L+'" alt=""></p><ol start="4"><li>部署成功后访问项目<br><a href="http://192.168.2.137:8080/springboot_jenkins-1.0/" target="_blank" rel="noreferrer">http://192.168.2.137:8080/springboot_jenkins-1.0/</a><br><img src="'+V+'" alt=""></li><li>改动代码后的持续集成 <ol><li>IDEA中源码修改并提交到gitlab</li><li>在Jenkins中项目重新构建</li><li>访问Tomcat</li></ol></li></ol><h2 id="_3-jenkins构建项目" tabindex="-1">3. Jenkins构建项目 <a class="header-anchor" href="#_3-jenkins构建项目" aria-label="Permalink to “3. Jenkins构建项目”">​</a></h2><h3 id="_3-1-构建的项目类型介绍" tabindex="-1">3.1 构建的项目类型介绍 <a class="header-anchor" href="#_3-1-构建的项目类型介绍" aria-label="Permalink to “3.1 构建的项目类型介绍”">​</a></h3><p>Jenkins中自动构建项目的类型有很多，常用的有以下三种:</p><ul><li>构建一个自由风格的软件项目</li><li>构建一个maven项目</li><li>流水线</li></ul><p>每种类型的构建其实都可以完成一样的构建过程与结果，只是在操作方式、灵活度等方面有所区别，在实际开发中可以根据自己的需求和习惯来选择。( 推荐使用流水线类型，因为灵活度非常高)</p><h3 id="_3-2-构建流水线项目" tabindex="-1">3.2 构建流水线项目 <a class="header-anchor" href="#_3-2-构建流水线项目" aria-label="Permalink to “3.2 构建流水线项目”">​</a></h3><h4 id="_3-2-1-pipeline简介" tabindex="-1">3.2.1 Pipeline简介 <a class="header-anchor" href="#_3-2-1-pipeline简介" aria-label="Permalink to “3.2.1 Pipeline简介”">​</a></h4><blockquote><p>Pipeline，简单来说，就是一套运行在Jenkins上的工作流框架，将原来独立运行于单个或者多个节点的任务连接起来，实现单个任务难以完成的复杂流程编排和可视化的工作。</p></blockquote><p><strong>使用Pipeline有以下好处</strong>(来自翻译自官方文档)︰</p><ul><li>代码︰Pipeline以代码的形式实现，通常被检入源代码控制，使团队能够编辑，审查和迭代其传送流程。</li><li>持久︰无论是计划内的还是计划外的服务器重启，Pipeline都是可恢复的。</li><li>可停止 : Pipeline可接收交互式输入，以确定是否继续执行Pipeline。</li><li>多功能:Pipeline支持现实世界中复杂的持续交付要求。它支持forkljoin、循环执行，并行执行任务的功能。</li><li>可扩展:Pipeline插件支持其DSL的自定义扩展，以及与其他插件集成的多个选项。</li></ul><p><strong>如何创建Jenkins Pipeline呢?</strong></p><ul><li>Pipeline脚本是由Groovy语言实现的，但是我们没必要单独去学习GroovyPipe</li><li>line支持两种语法:<strong>Declarative</strong>(声明式)和<strong>Scripted Pipeline</strong>(脚本式)语法</li><li>Pipeline也有两种创建方法∶可以直接在Jenkins 的Web UI界面中输入脚本;也可以通过创建一个Jenkinsfile脚本文件放入项目源码库中(一般我们都推荐在Jenkins 中直接从源代码控制(SCM)中直接载入Jenkinsfile Pipeline 这种方法)。</li></ul><p>如果创建项目没有流水线，则去插件管理搜索安装<code>Pipeline</code></p><h4 id="_3-2-2-pipeline语法快速入门" tabindex="-1">3.2.2 Pipeline语法快速入门 <a class="header-anchor" href="#_3-2-2-pipeline语法快速入门" aria-label="Permalink to “3.2.2 Pipeline语法快速入门”">​</a></h4><p><strong>Declarative声明式-Pipeline</strong><br>创建名为<code>pipeline01</code>的流水线项目<br>流水线→选择Hello World模板<br><img src="'+K+`" alt=""></p><p>会自动生成如下内容</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">pipeline {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    agent any</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    stages {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">        stage</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;Hello&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            steps {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">                echo </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;Hello World&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><ul><li>stages:代表整个流水线的所有执行阶段。通常stages只有1个，里面包含多个stage</li><li>stage :代表流水线中的某个阶段，可能出现n个。一般分为拉取代码，编译构建，部署等阶段。</li><li>steps:代表一个阶段内需要执行的逻辑。steps里面是shell脚本，git拉取代码，ssh远程发布等任意内容。</li></ul><p>编写一个简单声明式Pipeline :</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">pipeline {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    agent any</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    stages {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">        stage</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;拉取代码&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            steps {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">                echo </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;拉取代码&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">        stage</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;编译构建&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            steps {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">                echo </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;编译构建&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">        stage</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;项目部署&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            steps {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">                echo </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;项目部署&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><p>点击构建，可以看到整个构建过程<br><img src="`+Y+`" alt=""></p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">node {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    def mvnHome</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">    stage</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;Preparation&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) { </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// for display purposes</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">        // Get some code from a GitHub repository</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        git </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;https://github.com/jglick/simple-maven-project-with-tests.git&#39;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">        // Get the Maven tool.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">        // ** NOTE: This &#39;M3&#39; Maven tool must be configured</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">        // **       in the global configuration.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        mvnHome </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> tool </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;M3&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">    stage</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;Build&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">        // Run the maven build</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">        withEnv</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">([</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;MVN_HOME=$mvnHome&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">isUnix</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">()) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">                sh </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;&quot;$MVN_HOME/bin/mvn&quot; -Dmaven.test.failure.ignore clean package&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">                bat</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">/</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;%MVN_HOME%</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;">\\b</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">in</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;">\\m</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">vn&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">Dmaven.test.failure.ignore clean package</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">    stage</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;Results&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        junit </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;**/target/surefire-reports/TEST-*.xml&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        archiveArtifacts </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;target/*.jar&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><ul><li>Node :节点，一个Node就是一个Jenkins 节点，Master或者Agent，是执行Step的具体运行环境，后续讲到Jenkins的Master-Slave架构的时候用到。</li><li>Stage :阶段，一个Pipeline 可以划分为若干个Stage，每个Stage代表一组操作，比如︰Build、Test、Deploy , Stage是一个逻辑分组的概念。</li><li>Step:步骤，Step是最基本的操作单元，可以是打印一句话，也可以是构建一个Docker镜像，由各类Jenkins 插件提供，比如命令: sh &#39;make&#39;，就相当于我们平时shell终端中执行make命令一样。</li></ul><p>编写一个简单脚本式Pipeline :</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">node {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    def mvnHome</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">    stage</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;拉取代码&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) { </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// for display purposes</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        echo </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;拉取代码&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">    stage</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;编译构建&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">		echo </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;编译构建&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">    stage</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;项目部署&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">		echo </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;项目部署&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><p>构建结果和声明式一样</p><h4 id="_3-2-3-拉取代码" tabindex="-1">3.2.3 拉取代码 <a class="header-anchor" href="#_3-2-3-拉取代码" aria-label="Permalink to “3.2.3 拉取代码”">​</a></h4><p>新建<code>pipeline_demo01</code>流水线项目<br>点击流水线语法<br><img src="`+Z+`" alt=""><br>点击<code>生成流水线脚本</code> 就会出现以下内容</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span>checkout([$class: &#39;GitSCM&#39;, branches: [[name: &#39;*/master&#39;]], doGenerateSubmoduleConfigurations: false, extensions: [], submoduleCfg: [], userRemoteConfigs: [[credentialsId: &#39;6268be95-a137-4dd7-a33b-e46579610285&#39;, url: &#39;ssh://git@192.168.2.136:2222/chen_group/jenkins_demo.git&#39;]]])</span></span></code></pre></div><p>在流水线的steps中添加上一步生成的内容</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">pipeline {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    agent any</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    stages {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">        stage</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;拉取代码&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            steps {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">                checkout</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">([$class</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;GitSCM&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, branches</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [[name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;*/master&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]], doGenerateSubmoduleConfigurations</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, extensions</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [], submoduleCfg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [], userRemoteConfigs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [[credentialsId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;6268be95-a137-4dd7-a33b-e46579610285&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;ssh://git@192.168.2.136:2222/chen_group/jenkins_demo.git&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]]])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><p>点击<code>立即构建</code>就能拉取成功</p><h4 id="_3-2-4-编译打包" tabindex="-1">3.2.4 编译打包 <a class="header-anchor" href="#_3-2-4-编译打包" aria-label="Permalink to “3.2.4 编译打包”">​</a></h4><p>流水线语法选<code>sh: Shell Script</code></p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">pipeline {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    agent any</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    stages {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">        stage</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;拉取代码&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            steps {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">                checkout</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">([$class</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;GitSCM&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, branches</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [[name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;*/master&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]], doGenerateSubmoduleConfigurations</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, extensions</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [], submoduleCfg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [], userRemoteConfigs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [[credentialsId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;6268be95-a137-4dd7-a33b-e46579610285&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;ssh://git@192.168.2.136:2222/chen_group/jenkins_demo.git&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]]])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">        stage</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;编译构建&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            steps {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">                sh </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;mvn clean package&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><h4 id="_3-2-5-部署" tabindex="-1">3.2.5 部署 <a class="header-anchor" href="#_3-2-5-部署" aria-label="Permalink to “3.2.5 部署”">​</a></h4><p>以下语法通过流水线语法 <code>deploy: Deploy war/ear to a container</code>生成</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">pipeline {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    agent any</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    stages {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">        stage</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;拉取代码&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            steps {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">                checkout</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">([$class</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;GitSCM&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, branches</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [[name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;*/master&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]], doGenerateSubmoduleConfigurations</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, extensions</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [], submoduleCfg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [], userRemoteConfigs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [[credentialsId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;6268be95-a137-4dd7-a33b-e46579610285&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;ssh://git@192.168.2.136:2222/chen_group/jenkins_demo.git&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]]])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">        stage</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;编译构建&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            steps {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">                sh </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;mvn clean package&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">        stage</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;项目部署&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            steps {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">                deploy adapters</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">tomcat9</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(credentialsId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;fc219024-67b1-467f-9e54-1e4273547c6c&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, path</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;http://192.168.2.137:8080/&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)], contextPath</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, war</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;target/*.war&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><h4 id="_3-2-6-pipeline-script-from-scm" tabindex="-1">3.2.6 Pipeline Script from SCM <a class="header-anchor" href="#_3-2-6-pipeline-script-from-scm" aria-label="Permalink to “3.2.6 Pipeline Script from SCM”">​</a></h4><p>刚才我们都是直接在Jenkins的Ul界面编写Pipeline代码，这样不方便脚本维护，建议把Pipeline脚本放在项目中(一起进行版本控制)</p><ol><li><p>在项目根目录建立Jenkinsfile文件，把内容复制到该文件中，然后上传到Gitlab<br><img src="`+W+'" alt=""></p></li><li><p>在项目中引用该文件</p></li></ol><p><img src="'+$+'" alt=""></p><p><img src="'+ss+'" alt=""></p><h3 id="_3-3-常用的构建触发器" tabindex="-1">3.3 常用的构建触发器 <a class="header-anchor" href="#_3-3-常用的构建触发器" aria-label="Permalink to “3.3 常用的构建触发器”">​</a></h3><p>Jenkins内置的构建触发器<br><img src="'+is+'" alt=""></p><h4 id="_3-3-1-触发远程构建" tabindex="-1">3.3.1 触发远程构建 <a class="header-anchor" href="#_3-3-1-触发远程构建" aria-label="Permalink to “3.3.1 触发远程构建”">​</a></h4><p><img src="'+as+'" alt=""></p><h4 id="_3-3-2-其他工程构建后触发" tabindex="-1">3.3.2 其他工程构建后触发 <a class="header-anchor" href="#_3-3-2-其他工程构建后触发" aria-label="Permalink to “3.3.2 其他工程构建后触发”">​</a></h4><ol><li>创建<code>pre_job</code>流水线工程</li></ol><p><img src="'+ns+'" alt=""></p><ol start="2"><li>配置需要触发的工程</li></ol><p><img src="'+ls+'" alt=""></p><h4 id="_3-3-3-定时构建" tabindex="-1">3.3.3 定时构建 <a class="header-anchor" href="#_3-3-3-定时构建" aria-label="Permalink to “3.3.3 定时构建”">​</a></h4><p><img src="'+hs+'" alt=""><br>定时字符串从左往右分别为︰分时日月周<br>一些定时表达式的例子</p><blockquote><p>每30分钟构建一次: H代表形参 H/30 _ _ _ _ 每2个小时构建一次: H H/2 _ _ * 每天的8点，12点，22点，一天构建3次∶(多个时间点中间用逗号隔开) 0 8,12,22 _ _ * 每天中午12点定时构建一次 H 12 _ _ * 在每个小时的前半个小时内的每10分钟 H(0-29)/10 _ _ _ _ 每两小时一次，每个工作日上午9点到下午5点(也许是上午10:38，下午12:38，下午2:38，下午4:38) H H(9-16)/2 _ _ 1-5</p></blockquote><h4 id="_3-3-4-轮询-scm" tabindex="-1">3.3.4 轮询 SCM <a class="header-anchor" href="#_3-3-4-轮询-scm" aria-label="Permalink to “3.3.4 轮询 SCM”">​</a></h4><blockquote><p>轮询SCM，是指定时扫描本地代码仓库的代码是否有变更，如果代码有变更就触发项目构建。</p></blockquote><p>注意: 这次构建触发器，Jenkins会定时扫描本地整个项目的代码，增大系统的开销，不建议使用。</p><h3 id="_3-4-git-hook自动构件触发" tabindex="-1">3.4 Git hook自动构件触发 <a class="header-anchor" href="#_3-4-git-hook自动构件触发" aria-label="Permalink to “3.4 Git hook自动构件触发”">​</a></h3><p>刚才我们看到在Jenkins的内置构建触发器中，轮询SCM可以实现Gitlab代码更新，项目自动构建，但是该方案的性能不佳。那有没有更好的方案呢? 有的。就是利用Gitlab的webhook实现代码push到仓库，立即触发项目自动构建。</p><p><img src="'+ts+'" alt=""></p><h4 id="_3-4-1-安装-gitlab-hook-插件" tabindex="-1">3.4.1 安装 Gitlab Hook 插件 <a class="header-anchor" href="#_3-4-1-安装-gitlab-hook-插件" aria-label="Permalink to “3.4.1 安装 Gitlab Hook 插件”">​</a></h4><p>需要安装<code>GitLab</code>和<code>Gitlab Hook</code>两个插件</p><h4 id="_3-4-2-设置自动构建" tabindex="-1">3.4.2 设置自动构建 <a class="header-anchor" href="#_3-4-2-设置自动构建" aria-label="Permalink to “3.4.2 设置自动构建”">​</a></h4><p><img src="'+ps+'" alt=""><br>等会需要把生成的webhook URL配置到Gitlab中。<br><strong>Gitlab配置webhook</strong></p><ol><li>开启Webhook功能<br>使用root账户登录到后台，如下图所示勾选</li></ol><p><img src="'+ks+'" alt=""></p><ol start="2"><li>在项目添加webhook<br>在项目设置的<code>Webhooks</code>中<br><img src="'+es+'" alt=""><br>注意: 以下设置必须完成，否则会报错<br>在<code>系统管理→系统配置</code>中</li></ol><p><img src="'+rs+'" alt=""></p><ol start="3"><li>测试<br>提交一次代码，就会发现自动构件代码</li></ol><p><img src="'+ds+'" alt=""></p><h4 id="_3-4-3-参数化构建" tabindex="-1">3.4.3 参数化构建 <a class="header-anchor" href="#_3-4-3-参数化构建" aria-label="Permalink to “3.4.3 参数化构建”">​</a></h4><blockquote><p>有时在项目构建的过程中，我们需要根据用户的输入动态传入一些参数，从而影响整个构建结果，这时我们可以使用参数化构建。</p></blockquote><p>Jenkins支持非常丰富的参数类型<br><img src="'+gs+'" alt=""></p><p>接下来演示通过输入gitlab项目的分支名称来部署不同分支项目。<br>新建分支 v1 ，然后改动代码提交到GitLab上；此时Gitlab上就会有两个分支</p><p><strong>在 Jenkins 添加文本类型参数</strong><br><img src="'+os+'" alt=""></p><p>改动<code>pipeline</code>流水线代码</p><p><img src="'+As+'" alt=""></p><p><strong>点击Build with Parameters</strong></p><p><img src="'+ys+'" alt=""></p><p>输入分支名称，构建即可！构建完成后访问Tomcat查看结果</p><h4 id="_3-4-4-配置邮箱服务器发送构建结果" tabindex="-1">3.4.4 配置邮箱服务器发送构建结果 <a class="header-anchor" href="#_3-4-4-配置邮箱服务器发送构建结果" aria-label="Permalink to “3.4.4 配置邮箱服务器发送构建结果”">​</a></h4><p><strong>安装 Email Extension Template 插件</strong><br><strong>Jenkins设置邮箱相关参数</strong><br>在<code>系统管理</code>中配置<br><img src="'+Fs+'" alt=""></p><p>设置邮件参数</p><p><img src="'+Ds+'" alt=""></p><p><img src="'+cs+'" alt=""></p><p><img src="'+Cs+'" alt=""></p><p>设置邮件通知</p><p><img src="'+Bs+`" alt=""></p><p>点击<code>Test configuration</code>测试邮件是否发送成功<br><strong>准备邮件内容</strong><br>在项目根目录编写<code>email.html</code>，并把文件推送到Gitlab，内容如下</p><div class="language-html vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&lt;!</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">DOCTYPE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;"> html</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">html</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">head</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">meta</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;"> charset</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;UTF-8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">title</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;\${ENV, var=&quot;JOB_NAME&quot;}-第\${BUILD_NUMBER}次构建日志&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">title</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">head</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">body</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;"> leftmargin</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;8&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;"> marginwidth</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;0&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;"> topmargin</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;8&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;"> marginheight</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;4&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">      offset</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">table</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;"> width</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;95%&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;"> cellpadding</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;0&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;"> cellspacing</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;0&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">  style</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;font-size: 11pt; font-family: Tahoma, Arial, Helvetica, sans-serif&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">tr</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">td</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;以下为\${PROJECT_NAME }项目构建信息&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">td</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">tr</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">tr</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">td</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">br</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">b</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">span</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;"> style</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;color: #0B610B; &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;构建信息&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">span</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">b</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">hr</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;"> size</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;2&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;"> width</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;100%&quot;</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FF938A;--shiki-dark-font-style:italic;"> align</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;center&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> /&gt;&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">td</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">tr</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">tr</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">td</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">ul</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">li</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;项目名称：\${PROJECT_NAME}&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">li</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">li</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;构建编号：第\${BUILD_NUMBER}次构建&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">li</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">li</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;触发原因：\${CAUSE}&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">li</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">li</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;构建状态：\${BUILD_STATUS}&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">li</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">li</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;构建日志：&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">a</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;"> href</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;\${BUILD_URL}console&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;\${BUILD_URL}console&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">a</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">li</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">li</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;构建Url：&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">a</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;"> href</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;\${BUILD_URL}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;\${BUILD_URL}&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">a</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">li</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">li</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;工作目录：&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">a</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;"> href</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;\${PROJECT_URL}ws&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;\${PROJECT_URL}ws&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">a</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">li</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">li</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;项目Url：&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">a</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;"> href</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;\${PROJECT_URL}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;\${PROJECT_URL}&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">a</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">li</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">li</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;SonarQube结果：http://sonar****** &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">li</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">li</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;代码覆盖率结果：http://**/job/\${PROJECT_NAME}/\${BUILD_NUMBER}/jacoco/  &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">li</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">ul</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">td</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">tr</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">tr</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">td</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">b</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">span</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;"> style</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;color: #0B610B; &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;历史变更记录:&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">span</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">b</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">hr</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;"> size</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;2&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;"> width</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;100%&quot;</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FF938A;--shiki-dark-font-style:italic;"> align</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;center&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> /&gt;&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">td</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">tr</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">tr</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">td</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      \${CHANGES_SINCE_LAST_SUCCESS,reverse=true, format=&quot;Changes for Build #%n:&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">br</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> /&gt;%c&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">br</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> /&gt;&quot;,showPaths=true,changesFormat=&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">pre</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;[%a]&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">br</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> /&gt;%m&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">pre</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;&quot;,pathFormat=&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;">&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">%p&quot;}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">td</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">tr</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">table</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">body</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">html</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span></code></pre></div><p><strong>编写Jenkinsfile添加构建后发送邮件</strong></p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">pipeline {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    agent any</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    stages {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">        stage</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;拉取代码&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            steps {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">                checkout</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">([$class</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;GitSCM&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, branches</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [[name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;\${branch}&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]], doGenerateSubmoduleConfigurations</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, extensions</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [], submoduleCfg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [], userRemoteConfigs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [[credentialsId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;6268be95-a137-4dd7-a33b-e46579610285&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;ssh://git@192.168.2.136:2222/chen_group/jenkins_demo.git&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]]])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">        stage</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;编译构建&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            steps {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">                sh </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;mvn clean package&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">        stage</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;项目部署&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            steps {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">                deploy adapters</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">tomcat9</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(credentialsId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;fc219024-67b1-467f-9e54-1e4273547c6c&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, path</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;http://192.168.2.137:8080/&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)], contextPath</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, war</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;target/*.war&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    post {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        always {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">            emailext</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">( subject</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;构建通知：\${PROJECT_NAME} - Build # \${BUILD_NUMBER} - \${BUILD_STATUS}!&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            body</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;\${FILE,path=&quot;email.html&quot;}&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            to</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;535395726@qq.com&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><p><strong>测试</strong><br><img src="`+bs+'" alt=""></p><h3 id="_3-5-安装sonarqube" tabindex="-1">3.5 安装SonarQube <a class="header-anchor" href="#_3-5-安装sonarqube" aria-label="Permalink to “3.5 安装SonarQube”">​</a></h3><p><img src="'+us+`" alt=""></p><h4 id="_1-使用docker的方式安装" tabindex="-1">1. 使用docker的方式安装 <a class="header-anchor" href="#_1-使用docker的方式安装" aria-label="Permalink to “1. 使用docker的方式安装”">​</a></h4><p>这里只是简单的拉取部署，使用内嵌数据库，只能用于测试场景</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 拉取镜像</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> pull</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> sonarqube</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 运行</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -d</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 9000:9000</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">  --name</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> sonarqube</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> sonarqube</span></span></code></pre></div><p>访问 <a href="http://192.168.2.137:9000/" target="_blank" rel="noreferrer">http://192.168.2.137:9000/</a><br><img src="`+ms+'" alt=""></p><h4 id="_2-安装汉化包" tabindex="-1">2. 安装汉化包 <a class="header-anchor" href="#_2-安装汉化包" aria-label="Permalink to “2. 安装汉化包”">​</a></h4><p><img src="'+Es+'" alt=""><br>安装完后重新启动服务</p><h4 id="_3-生成token" tabindex="-1">3. 生成token <a class="header-anchor" href="#_3-生成token" aria-label="Permalink to “3. 生成token”">​</a></h4><p>点击头像→我的帐号→安全→生成令牌<br><img src="'+vs+`" alt=""></p><h4 id="_4-测试使用" tabindex="-1">4. 测试使用 <a class="header-anchor" href="#_4-测试使用" aria-label="Permalink to “4. 测试使用”">​</a></h4><p>到 idea 的 Terminal 执行</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">mvn</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> sonar:sonar</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;">  \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">  -Dsonar.host.url=http://192.168.2.137:9000</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;">  \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">  -Dsonar.login=5952d0bdb9b2607901c5e2d7e73807354bc7763a</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;">  \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">  -Dsonar.java.binaries=target/sonar</span></span></code></pre></div><p><img src="`+fs+'" alt=""></p><h4 id="_5-安装-sonarqube-scanner-插件" tabindex="-1">5. 安装 SonarQube Scanner 插件 <a class="header-anchor" href="#_5-安装-sonarqube-scanner-插件" aria-label="Permalink to “5. 安装 SonarQube Scanner 插件”">​</a></h4><p>过程略。。。</p><h4 id="_6-添加-sonarqube-凭证" tabindex="-1">6. 添加 SonarQube 凭证 <a class="header-anchor" href="#_6-添加-sonarqube-凭证" aria-label="Permalink to “6. 添加 SonarQube 凭证”">​</a></h4><p><img src="'+qs+'" alt=""></p><h4 id="_7-在系统配置中的-sonarqube-servers-中配置" tabindex="-1">7. 在系统配置中的 SonarQube servers 中配置 <a class="header-anchor" href="#_7-在系统配置中的-sonarqube-servers-中配置" aria-label="Permalink to “7. 在系统配置中的 SonarQube servers 中配置”">​</a></h4><p><img src="'+xs+'" alt=""></p><h4 id="_8-sonaqube关闭审查结果上传到scm功能" tabindex="-1">8.  SonaQube关闭审查结果上传到SCM功能 <a class="header-anchor" href="#_8-sonaqube关闭审查结果上传到scm功能" aria-label="Permalink to “8.  SonaQube关闭审查结果上传到SCM功能”">​</a></h4><p><img src="'+js+`" alt=""></p><h4 id="_9-在项目添加sonaqube代码审查-非流水线项目" tabindex="-1">9.  在项目添加SonaQube代码审查（非流水线项目） <a class="header-anchor" href="#_9-在项目添加sonaqube代码审查-非流水线项目" aria-label="Permalink to “9.  在项目添加SonaQube代码审查（非流水线项目）”">​</a></h4><p>在项目构件里添加构建步骤，选择Execute SonarQube Scanner<br>在 Analysis properties 中输入以下内容</p><div class="language-properties vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">properties</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># must be unique in a given SonarQube instance</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">sonar.projectKey</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">=Jenkins_demo</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># this is the name and version displayed in the SonarQube UI. Was mandatory prior to SonarQube 6.1.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">sonar.projectName</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">=Jenkins_demo</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">sonar.projectVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">=1.0</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># Path is relative to the sonar-project.properties file. Replace &quot;\\&quot; by &quot;/&quot; on Windows.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># This property is optional if sonar.modules is set.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">sonar.sources</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">=.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">sonar.exclusions</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">=**/test/**,**/target/**</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">sonar.java.source</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">=1.8</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">sonar.java.target</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">=1.8</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">sonar.java.binaries</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">=target/classes</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># Encoding of the source code. Default is default system encoding</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">sonar.sourceEncoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">=UTF-8</span></span></code></pre></div><p>执行构建后，回到 SonaQube 就能看到相应的项目</p><h4 id="_10-在项目添加sonaqube代码审查-流水线项目" tabindex="-1">10. 在项目添加SonaQube代码审查（流水线项目） <a class="header-anchor" href="#_10-在项目添加sonaqube代码审查-流水线项目" aria-label="Permalink to “10. 在项目添加SonaQube代码审查（流水线项目）”">​</a></h4><ol><li>在项目根目录下，创建sonar-project.properties文件，内容同上</li><li>修改Jenkinsfile，加入SonarQube代码审查阶段</li></ol><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">pipeline {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    agent any</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    stages {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">        stage</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;拉取代码&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            steps {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">                checkout</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">([$class</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;GitSCM&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, branches</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [[name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;\${branch}&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]], doGenerateSubmoduleConfigurations</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, extensions</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [], submoduleCfg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [], userRemoteConfigs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [[credentialsId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;6268be95-a137-4dd7-a33b-e46579610285&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;ssh://git@192.168.2.136:2222/chen_group/jenkins_demo.git&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]]])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">        stage</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;代码审查&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            steps {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">                // 引入SonarQube的服务器环境,名称对应\`系统配置\`里的名称</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">                withSonarQubeEnv</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;SonarQube 8.6&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">                    sh </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;mvn sonar:sonar -Dproject.settings=sonar-project.properties&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">                }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">        stage</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;编译构建&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            steps {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">                sh </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;mvn clean package&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">        stage</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;项目部署&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            steps {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">                deploy adapters</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">tomcat9</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(credentialsId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;fc219024-67b1-467f-9e54-1e4273547c6c&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, path</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;http://192.168.2.137:8080/&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)], contextPath</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, war</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;target/*.war&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    post {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        always {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">            emailext</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">( subject</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;构建通知：\${PROJECT_NAME} - Build # \${BUILD_NUMBER} - \${BUILD_STATUS}!&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            body</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;\${FILE,path=&quot;email.html&quot;}&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            to</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;535395726@qq.com&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><ol start="3"><li>到SonarQube的UI界面查看审查结果</li></ol><h2 id="_4-jenkins-docker-springcloud微服务持续集成" tabindex="-1">4. Jenkins+Docker+SpringCloud微服务持续集成 <a class="header-anchor" href="#_4-jenkins-docker-springcloud微服务持续集成" aria-label="Permalink to “4. Jenkins+Docker+SpringCloud微服务持续集成”">​</a></h2><h3 id="_4-1-持续集成流程说明" tabindex="-1">4.1 持续集成流程说明 <a class="header-anchor" href="#_4-1-持续集成流程说明" aria-label="Permalink to “4.1 持续集成流程说明”">​</a></h3><p><img src="`+Ps+`" alt=""><br>大致流程说明︰</p><ol><li>开发人员每天把代码提交到Gitlab代码仓库</li><li>Jenkins从Gitlab中拉取项目源码，编译并打成jar包，然后构建成Docker镜像，将镜像上传到Harbor私有仓库。</li><li>Jenkins发送SSH远程命令，让生产部署服务器到Harbor私有仓库拉取镜像到本地，然后创建容器。</li><li>最后，用户可以访问到容器</li></ol><p><strong>服务列表</strong></p><table tabindex="0"><thead><tr><th style="text-align:left;">服务器名称</th><th style="text-align:left;">IP地址</th><th style="text-align:left;">端口</th><th style="text-align:left;">安装的软件</th></tr></thead><tbody><tr><td style="text-align:left;">代码托管服务器</td><td style="text-align:left;">192.168.2.136</td><td style="text-align:left;">8880</td><td style="text-align:left;">Gitlab</td></tr><tr><td style="text-align:left;">持续集成服务器</td><td style="text-align:left;">192.168.2.136</td><td style="text-align:left;">8080</td><td style="text-align:left;">Jenkins，Maven</td></tr><tr><td style="text-align:left;">Docker仓库服务器</td><td style="text-align:left;">192.168.2.138</td><td style="text-align:left;">80</td><td style="text-align:left;">Harbor</td></tr><tr><td style="text-align:left;">生产部署服务器</td><td style="text-align:left;">192.168.2.137</td><td style="text-align:left;"></td><td style="text-align:left;"></td></tr></tbody></table><p>注:本人案例代码托管和持续集成服务用同一台服务器</p><h3 id="_4-2-docker、dockerfile、docker-compose的安装及使用" tabindex="-1">4.2 Docker、Dockerfile、docker-compose的安装及使用 <a class="header-anchor" href="#_4-2-docker、dockerfile、docker-compose的安装及使用" aria-label="Permalink to “4.2 Docker、Dockerfile、docker-compose的安装及使用”">​</a></h3><p><strong>使用Dockerfile制作微服务镜像</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> openjdk:11.0.8-slim</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">VOLUME</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /tmp</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">ADD</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> gateway-server-1.0.0.jar</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /gateway-server-1.0.0.jar</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">EXPOSE</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 9527</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">ENTRYPOINT</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;java&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;-Djava.security.egd=file:/dev/./urandom&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;-jar&quot;,&quot;/gateway-server-1.0.0.jar&quot;,&quot;--spring.profiles.active=prod&quot;]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">MAINTAINER</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> manaphy</span></span></code></pre></div><p>构建镜像</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> gateway-server:v1</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> .</span></span></code></pre></div><h3 id="_4-3-harbor镜像仓库安装及使用" tabindex="-1">4.3 Harbor镜像仓库安装及使用 <a class="header-anchor" href="#_4-3-harbor镜像仓库安装及使用" aria-label="Permalink to “4.3 Harbor镜像仓库安装及使用”">​</a></h3><p><img src="`+_s+`" alt=""></p><p>Harbor(港口，港湾)是一个用于存储和分发Docker镜像的企业级Registry服务器。<br>除了Harbor这个私有镜像仓库之外，还有Docker官方提供的Registry。相对Registry，Harbor具有很多优势∶</p><ol><li>提供分层传输机制，优化网络传输Docker镜像是是分层的，而如果每次传输都使用全量文件(所以用FTP的方式并不适合)，显然不经济。必须提供识别分层传输的机制，以层的UUID为标识，确定传输的对象。</li><li>提供WEB界面，优化用户体验只用镜像的名字来进行上传下载显然很不方便，需要有一个用户界面可以支持登陆、搜索功能，包括区分公有、私有镜像。</li><li>支持水平扩展集群当有用户对镜像的上传下载操作集中在某服务器，需要对相应的访问压力作分解。</li><li>良好的安全机制企业中的开发团队有很多不同的职位，对于不同的职位人员，分配不同的权限，具有更好的安全性。</li></ol><h4 id="_4-3-1-harbor安装" tabindex="-1">4.3.1 Harbor安装 <a class="header-anchor" href="#_4-3-1-harbor安装" aria-label="Permalink to “4.3.1 Harbor安装”">​</a></h4><p>从 github 上下载 Harbor 的压缩包 <a href="https://github.com/goharbor/harbor" target="_blank" rel="noreferrer">https://github.com/goharbor/harbor</a><br>上传压缩包到目标服务器，并解压</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 解压</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">tar</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -zxvf</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> harbor-offline-installer-v2.1.3.tgz</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 修改 Harbor 的配置</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">vim</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> harbor.yml</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 修改 hostname 和 port(如果有需要)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">hostname:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 192.168.2.138</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> #修改为本机ip地址</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">http:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  port:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 80</span></span></code></pre></div><p>如果不是https环境,则注释以下代码</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># https related config</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#https:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">  # https port for harbor, default is 443</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#  port: 443</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">  # The path of cert and key files for nginx</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#  certificate: /your/certificate/path</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#  private_key: /your/private/key/path</span></span></code></pre></div><p>安装并启动 Harbor</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">./prepare</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">./install.sh</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 安装完后会生成一个 docker-compose.yml 文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> up</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -d</span></span></code></pre></div><p>访问 Harbor <a href="http://192.168.2.138/" target="_blank" rel="noreferrer">http://192.168.2.138/</a><br>默认账户密码: admin/Harbor12345 (可在harbor.yml中进行查看修改)</p><h4 id="_4-3-2-在-harbor-创建用户和项目" tabindex="-1">4.3.2 在 Harbor 创建用户和项目 <a class="header-anchor" href="#_4-3-2-在-harbor-创建用户和项目" aria-label="Permalink to “4.3.2 在 Harbor 创建用户和项目”">​</a></h4><p><strong>创建项目</strong><br>Harbor的项目分为公开和私有的:<br>公开项目︰所有用户都可以访问，通常存放公共的镜像，默认有一个library公开项目。<br>私有项目∶只有授权用户才可以访问，通常存放项目本身的镜像。<br>我们可以为微服务项目创建一个新的项目∶<br><img src="`+Rs+`" alt=""></p><table tabindex="0"><thead><tr><th style="text-align:left;">角色</th><th style="text-align:left;">权限说明</th></tr></thead><tbody><tr><td style="text-align:left;">访客</td><td style="text-align:left;">对于指定项目拥有只读权限</td></tr><tr><td style="text-align:left;">开发人员</td><td style="text-align:left;">对于指定项目拥有读写权限</td></tr><tr><td style="text-align:left;">维护人员</td><td style="text-align:left;">对于指定项目拥有读写权限，创建 Webhooks</td></tr><tr><td style="text-align:left;">项目管理员</td><td style="text-align:left;">除了读写权限，同时拥有用户管理/镜像扫描等管理权限</td></tr></tbody></table><p>用新用户登录 Harbor</p><h4 id="_4-3-3-把镜像上传到harbor" tabindex="-1">4.3.3 把镜像上传到Harbor <a class="header-anchor" href="#_4-3-3-把镜像上传到harbor" aria-label="Permalink to “4.3.3 把镜像上传到Harbor”">​</a></h4><ol><li>给镜像打上标签</li></ol><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> tag</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> gateway-server:v1</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 192.168.2.138:80/jenkins/gateway-server:v1</span></span></code></pre></div><ol start="2"><li>推送镜像</li></ol><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> push</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 192.168.2.138:80/jenkins/gateway-server:v1</span></span></code></pre></div><p>这时会出现以下报错，是因为Docker没有把Harbor加入信任列表中</p><ol start="3"><li>把Harbor地址加入到Docker信任列表<br>编辑<code>/etc/docker/daemon.json</code></li></ol><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&quot;registry-mirrors&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;https://docker.mirrors.ustc.edu.cn&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">],</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&quot;insecure-registries&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&quot;192.168.2.138:80&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><p>需要重启docker</p><ol start="4"><li>再次执行推送命令，会提示权限不足</li></ol><p><code>denied: requested access to the resource is denied</code><br>需要先登录Harbor，再推送镜像</p><ol start="5"><li>登录Harbor</li></ol><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> login</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -u</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> manaphy</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 你的密码</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 192.168.2.138:80</span></span></code></pre></div><p>再次推送镜像<br><img src="`+zs+`" alt=""></p><h4 id="_4-3-4-从harbor下载镜像" tabindex="-1">4.3.4 从Harbor下载镜像 <a class="header-anchor" href="#_4-3-4-从harbor下载镜像" aria-label="Permalink to “4.3.4 从Harbor下载镜像”">​</a></h4><p>在安装部署服务器上完成从 Harbor 下载镜像</p><ol><li>安装Docker，并启动Docker</li><li>修改Docker配置<br>编辑<code>/etc/docker/daemon.json</code></li></ol><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&quot;registry-mirrors&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;https://docker.mirrors.ustc.edu.cn&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">],</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&quot;insecure-registries&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&quot;192.168.2.138:80&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><p><br>重启Docker</p><ol start="3"><li>先登录，在从Harbor上下载</li></ol><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> login</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -u</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> manaphy</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 你的密码</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 192.168.2.138:80</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> pull</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 192.168.2.138:80/jenkins/gateway-server:v1</span></span></code></pre></div><h3 id="_4-4-项目代码上传到gitlib" tabindex="-1">4.4 项目代码上传到GitLib <a class="header-anchor" href="#_4-4-项目代码上传到gitlib" aria-label="Permalink to “4.4 项目代码上传到GitLib”">​</a></h3><p>过程略...</p><h3 id="_4-5-从gitlib拉取项目源码" tabindex="-1">4.5 从GitLib拉取项目源码 <a class="header-anchor" href="#_4-5-从gitlib拉取项目源码" aria-label="Permalink to “4.5 从GitLib拉取项目源码”">​</a></h3><p><strong>创建Jenkinsfile文件</strong></p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// gitlab 凭证</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">def git_auth </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;6268be95-a137-4dd7-a33b-e46579610285&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">node {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">    stage</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;拉取代码&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">        checkout</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">([$class</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;GitSCM&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, branches</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [[name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;*/master&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]], doGenerateSubmoduleConfigurations</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, extensions</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [], submoduleCfg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [], userRemoteConfigs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [[credentialsId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;6268be95-a137-4dd7-a33b-e46579610285&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;ssh://git@192.168.2.136:2222/chen_group/springcloud.git&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]]])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><p><strong>拉取Jenkinsfile文件</strong><br>创建新项目<br><img src="`+Ms+'" alt=""></p><h3 id="_4-6-提交到sonarqube代码审查" tabindex="-1">4.6 提交到SonarQube代码审查 <a class="header-anchor" href="#_4-6-提交到sonarqube代码审查" aria-label="Permalink to “4.6 提交到SonarQube代码审查”">​</a></h3><ol><li>在项目配置中的<code>参数化构建过程</code>中添加两个参数</li></ol><p><img src="'+Ss+'" alt=""></p><p><img src="'+Gs+`" alt=""></p><ol start="2"><li>在每个项目的根的目录下添加<code>sonar-project.properties</code></li></ol><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># must be unique in a given SonarQube instance</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">sonar.projectKey</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">=manaphy-bms</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># this is the name and version displayed in the SonarQube UI. Was mandatory prior to SonarQube 6.1.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">sonar.projectName</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">=manaphy-bms</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">sonar.projectVersion</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">=1.0</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># Path is relative to the sonar-project.properties file. Replace &quot;\\&quot; by &quot;/&quot; on Windows.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># This property is optional if sonar.modules is set.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">sonar.sources</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">sonar.exclusions</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">=**/test/**,**/target/**</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">sonar.java.source</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">=1.8</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">sonar.java.target</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">=1.8</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">sonar.java.binaries</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">=./target/classes</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># Encoding of the source code. Default is default system encoding</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">sonar.sourceEncoding</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">=UTF-8</span></span></code></pre></div><p>注意修改<code>sonar.projectKey</code>和<code>sonar.projectName</code></p><ol start="3"><li>修改Jenkinsfile构建脚本</li></ol><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// gitlab 凭证</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">def git_auth </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;6268be95-a137-4dd7-a33b-e46579610285&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">node {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">    stage</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;拉取代码&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">        checkout</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">([$class</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;GitSCM&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, branches</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [[name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;*/\${branch}&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]], doGenerateSubmoduleConfigurations</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, extensions</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [], submoduleCfg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [], userRemoteConfigs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [[credentialsId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;6268be95-a137-4dd7-a33b-e46579610285&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;ssh://git@192.168.2.136:2222/chen_group/springcloud.git&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]]])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">    stage</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;代码审查&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        steps {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">            // 引入SonarQube的服务器环境,名称对应\`系统配置\`里的名称</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">            withSonarQubeEnv</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;SonarQube 8.6&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">                sh </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;mvn sonar:sonar -Dproject.settings=sonar-project.properties&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><h3 id="_4-7-使用dockerfile编译、生成镜像" tabindex="-1">4.7 使用Dockerfile编译、生成镜像 <a class="header-anchor" href="#_4-7-使用dockerfile编译、生成镜像" aria-label="Permalink to “4.7 使用Dockerfile编译、生成镜像”">​</a></h3><p>利用<code>dockerfile-maven-plugin</code>插件构建Docker镜像</p><ol><li>在每个微服务项目的pom.xml加入dockerfile-maven-plugin插件</li></ol><div class="language-xml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">build</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">plugins</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">plugin</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">groupId</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;com.spotify&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">groupId</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">artifactId</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;dockerfile-maven-plugin&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">artifactId</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">version</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;1.4.9&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">version</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">configuration</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">                &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">repository</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;\${project.artifactId}&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">repository</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">                &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">buildArgs</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">                    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">JAR_FILE</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;target/\${project.build.finalName}.jar&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">JAR_FILE</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">                &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">buildArgs</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">configuration</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">plugin</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">plugins</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">build</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span></code></pre></div><ol start="2"><li>在每个微服务项目根目录下建立Dockerfile文件</li></ol><div class="language-dockerfile vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> openjdk:8-jdk-alpine</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">ARG</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> JAR_FILE</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> \${JAR_FILE} app.jar</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">EXPOSE</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> 8080</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">ENTRYPOINT</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;java&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;-jar&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;/app.jar&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]</span></span></code></pre></div><p>注意: 每个项目的公开端口不一样</p><ol start="3"><li>修改Jenkinsfile构建脚本</li></ol><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// gitlab 凭证</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">def git_auth </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;6268be95-a137-4dd7-a33b-e46579610285&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 构建版本的名称</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">def tag </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;latest&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// Harbor私服的地址</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">def harbor_url </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;192.168.2.138:80/jenkins/&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">node {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">    stage</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;拉取代码&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">        checkout</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">([$class</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;GitSCM&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, branches</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [[name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;*/\${branch}&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]], doGenerateSubmoduleConfigurations</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, extensions</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [], submoduleCfg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [], userRemoteConfigs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [[credentialsId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;6268be95-a137-4dd7-a33b-e46579610285&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;ssh://git@192.168.2.136:2222/chen_group/springcloud.git&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]]])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">    stage</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;代码审查&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        steps {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">            // 引入SonarQube的服务器环境,名称对应\`系统配置\`里的名称</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">            withSonarQubeEnv</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;SonarQube 8.6&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">                sh </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;mvn sonar:sonar -Dproject.settings=sonar-project.properties&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">    stage</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;编译,构建镜像&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">        // 定义镜像名称</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        def imageName </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;\${project_name}:\${tag}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">        // 编译,安装公共工程</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        sh </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;mvn -f manaphy-common clean install&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">        //编译,构建本地镜像</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        sh </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;mvn -f \${project_name} clean package dockerfile:build&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><p>注意：如果出现找不到父工程依赖，需要手动把父工程的依赖上传到仓库中</p><h3 id="_4-8-上传到harbor镜像仓库" tabindex="-1">4.8 上传到Harbor镜像仓库 <a class="header-anchor" href="#_4-8-上传到harbor镜像仓库" aria-label="Permalink to “4.8 上传到Harbor镜像仓库”">​</a></h3><ol><li>修改Jenkinsfile构建脚本</li></ol><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// gitlab 凭证</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">def git_auth </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;6268be95-a137-4dd7-a33b-e46579610285&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 构建版本的名称</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">def tag </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;latest&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// Harbor私服的地址</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">def harbor_url </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;192.168.2.138:80&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// Harbor的项目名称</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">def harbor_project_name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;jenkins&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// Harbor的凭证</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">def harbor_auth </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;	51621e44-da6e-422b-9522-3ddae4fd1975&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">node {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">    stage</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;拉取代码&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">        checkout</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">([$class</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;GitSCM&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, branches</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [[name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;*/\${branch}&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]], doGenerateSubmoduleConfigurations</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, extensions</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [], submoduleCfg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [], userRemoteConfigs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [[credentialsId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;6268be95-a137-4dd7-a33b-e46579610285&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;ssh://git@192.168.2.136:2222/chen_group/springcloud.git&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]]])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">    stage</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;代码审查&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        steps {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">            // 引入SonarQube的服务器环境,名称对应\`系统配置\`里的名称</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">            withSonarQubeEnv</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;SonarQube 8.6&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">                sh </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;mvn sonar:sonar -Dproject.settings=sonar-project.properties&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">    stage</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;编译,构建镜像&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">        // 定义镜像名称</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        def imageName </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;\${project_name}:\${tag}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">        // 编译,安装公共工程</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        sh </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;mvn -f manaphy-common clean install&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">        // 编译,构建本地镜像</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        sh </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;mvn -f \${project_name} clean package dockerfile:build&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">        // 给镜像打标签</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        sh </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;docker tag \${imageName}#{harbor_url}/\${harbor_project_name}/\${imageName}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">        //登录Harbor,并上传镜像</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">        withCredentials</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">([</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">usernamePassword</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(credentialsId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;\${harbor_auth}&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, passwordVariable</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;password&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, usernameVariable</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;username&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)]) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">            // 登录</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            sh </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;docker login -u \${username} -p {password} \${harbor_url}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">            // 上传镜像</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            sh </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;docker push \${harbor_url}/\${harbor_project_name}/\${imageName}&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">        // 删除本地镜像</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        sh </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;docker rmi -f \${imageName}&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        sh </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;docker rmi -f \${harbor_url}/\${harbor_project_name}/\${imageName}&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><ol start="2"><li>使用凭证管理Harbor私服账户和密码</li></ol><p><img src="`+Ts+`" alt=""></p><h3 id="_4-9-拉取镜像和发布应用" tabindex="-1">4.9 拉取镜像和发布应用 <a class="header-anchor" href="#_4-9-拉取镜像和发布应用" aria-label="Permalink to “4.9 拉取镜像和发布应用”">​</a></h3><h4 id="_4-9-1-安装-publish-over-ssh-插件" tabindex="-1">4.9.1 安装 Publish Over SSH 插件 <a class="header-anchor" href="#_4-9-1-安装-publish-over-ssh-插件" aria-label="Permalink to “4.9.1 安装 Publish Over SSH 插件”">​</a></h4><blockquote><p>该插件可以实现远程发送Shell命令</p></blockquote><p>过程略...</p><h4 id="_4-9-2-配置远程部署服务器" tabindex="-1">4.9.2 配置远程部署服务器 <a class="header-anchor" href="#_4-9-2-配置远程部署服务器" aria-label="Permalink to “4.9.2 配置远程部署服务器”">​</a></h4><ol><li>复制公钥到远程服务器(密钥生成方式在 2.7.2)<br>将<strong>持续集成服务器</strong>上生成过密钥复制到<strong>生产部署服务器</strong></li></ol><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">ssh-copy-id</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 192.168.2.137</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 以上方式使用默认的22端口,如指定端口号则使用</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">ssh-copy-id</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -p</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 22</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 192.168.2.137</span></span></code></pre></div><ol start="2"><li>将持续集成服务器上的密钥复制到Jenkins容器中</li></ol><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> cp</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /root/.ssh/</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> jenkins:/root/</span></span></code></pre></div><ol start="3"><li>在<code>系统配置→Publish over SSH</code></li></ol><p><img src="`+Os+'" alt=""></p><p><img src="'+Js+'" alt=""></p><h4 id="_4-9-3-修改jenkinsfile构建脚本" tabindex="-1">4.9.3 修改Jenkinsfile构建脚本 <a class="header-anchor" href="#_4-9-3-修改jenkinsfile构建脚本" aria-label="Permalink to “4.9.3 修改Jenkinsfile构建脚本”">​</a></h4><p>生成远程调用模板代码<br><img src="'+Hs+'" alt=""></p><p>添加一个<code>port</code>参数<br><img src="'+Us+`" alt=""></p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// gitlab 凭证</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">def GIT_AUTH </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;6268be95-a137-4dd7-a33b-e46579610285&#39;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// gitlab的ssh地址</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">def SSH_URL </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;ssh://git@192.168.2.136:2222/chen_group/springcloud.git&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 构建版本的名称</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">def TAG </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;latest&#39;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// Harbor私服的地址</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">def HARBOR_URL </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;192.168.2.138:80&#39;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// Harbor的项目名称</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">def HARBOR_PROJECT_NAME </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;jenkins&#39;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// Harbor的凭证</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">def HARBOR_AUTH </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;	51621e44-da6e-422b-9522-3ddae4fd1975&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">node {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">    stage</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;拉取代码&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">        checkout</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">([$class</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;GitSCM&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, branches</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [[name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;*/\${branch}&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]], doGenerateSubmoduleConfigurations</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, extensions</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [], submoduleCfg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [], userRemoteConfigs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [[credentialsId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;\${GIT_AUTH}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;\${SSH_URL}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]]])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">    stage</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;代码审查&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">        // 引入SonarQube的服务器环境,名称对应\`系统配置\`里的名称</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">        withSonarQubeEnv</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;SonarQube 8.6&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            sh </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">            cd \${project_name}</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">            mvn sonar:sonar -Dproject.settings=sonar-project.properties</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">            &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">    stage</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;编译,构建镜像&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">        // 定义镜像名称</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        def imageName </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;\${project_name}:\${TAG}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">        // 编译,安装公共工程</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">        // sh &quot;mvn -f manaphy-common clean install&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">        // 编译,构建本地镜像</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        sh </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;mvn -f \${project_name} clean package  -DskipTests dockerfile:build&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">        // 给镜像打标签</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        sh </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;docker tag \${imageName} \${HARBOR_URL}/\${HARBOR_PROJECT_NAME}/\${imageName}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">        //登录Harbor,并上传镜像</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">        withCredentials</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">([</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">usernamePassword</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(credentialsId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;\${HARBOR_AUTH}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, passwordVariable</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;password&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, usernameVariable</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;username&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)]) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">            // 登录</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            sh </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;docker login -u \${username} -p \${password} \${HARBOR_URL}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">            // 上传镜像</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            sh </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;docker push \${HARBOR_URL}/\${HARBOR_PROJECT_NAME}/\${imageName}&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">        // 删除本地镜像</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        sh </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;docker rmi -f \${imageName}&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        sh </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;docker rmi -f \${HARBOR_URL}/\${HARBOR_PROJECT_NAME}/\${imageName}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">        // =====&gt; 以下为远程调用进行项目部署 &lt;=====</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">        sshPublisher</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(publishers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">sshPublisherDesc</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(configName</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;prod-server&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, transfers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">sshTransfer</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(cleanRemote</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,excludes</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,execCommand</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;/root/deploy/deploy.sh $HARBOR_URL $HARBOR_PROJECT_NAME $PROJECT_NAME $TAG $PORT&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,execTimeout</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 120000</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,flatten</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,makeEmptyDirs</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,noDefaultExcludes</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, patternSeparator</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;[, ]+&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, remoteDirectory</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,remoteDirectorySDF</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, removePrefix</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, sourceFiles</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)], usePromotionTimestamp</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, useWorkspaceInPromotion</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><h4 id="_4-9-4-编写deploy-sh部署脚本" tabindex="-1">4.9.4 编写deploy.sh部署脚本 <a class="header-anchor" href="#_4-9-4-编写deploy-sh部署脚本" aria-label="Permalink to “4.9.4 编写deploy.sh部署脚本”">​</a></h4><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#!/bin/sh</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 接收外部参数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">harbor_url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">$1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">harbor_project_name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">$2</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">project_name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">$3</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">tag</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">$4</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">port</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">$5</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">imageName</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">$harbor_url</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">$harbor_project_name</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">$project_name</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">$tag</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">$imageName</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 查询容器是否存在,存在则删除</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">containerId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ps</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -a</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -w</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;\${</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">project_name</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">}&quot;:&quot;\${</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">tag</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">}&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> awk</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;{print $1}&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [ </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">$containerId</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> !=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> ]; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">then</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">  # 停掉容器</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  docker</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> stop</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">$containerId</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">  # 删除容器</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  docker</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> rm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">$containerId</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">  echo</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;成功删除容器&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 查询镜像是否存在,存在则删除</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">imageId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> images</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -w</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;\${</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">project_name</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">}&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> awk</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;{print $3}&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [ </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">$imageId</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> !=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> ]; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">then</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">  # 删除镜像</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  docker</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> rmi</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">$imageId</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">  echo</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;成功删除镜像&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 登录Harbor私服</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> login</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -u</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> manaphy</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Chen1111</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">$harbor_url</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 下载镜像</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> pull</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">$imageName</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;成功下载镜像&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 启动容器</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -id</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">$port</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">$port</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --name</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">$project_name</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">$imageName</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;容器启动成功&quot;</span></span></code></pre></div><p>上传deploy.sh文件到生产部署服务器的<code>/root/deploy</code>目录下，给文件执行权限</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">chmod</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> +x</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> deploy.sh</span></span></code></pre></div><p><strong>执行构建测试</strong></p><h3 id="_4-10-部署前端静态web网站" tabindex="-1">4.10 部署前端静态web网站 <a class="header-anchor" href="#_4-10-部署前端静态web网站" aria-label="Permalink to “4.10 部署前端静态web网站”">​</a></h3><p><img src="`+Ns+'" alt=""></p><h4 id="_4-10-1-生产服务器安装nginx" tabindex="-1">4.10.1 生产服务器安装Nginx <a class="header-anchor" href="#_4-10-1-生产服务器安装nginx" aria-label="Permalink to “4.10.1 生产服务器安装Nginx”">​</a></h4><p>过程略...</p><h4 id="_4-10-2-安装-nodejs-插件" tabindex="-1">4.10.2 安装 NodeJS 插件 <a class="header-anchor" href="#_4-10-2-安装-nodejs-插件" aria-label="Permalink to “4.10.2 安装 NodeJS 插件”">​</a></h4><p>过程略...</p><h4 id="_4-10-3-jenkins配置nodejs" tabindex="-1">4.10.3 Jenkins配置NodeJS <a class="header-anchor" href="#_4-10-3-jenkins配置nodejs" aria-label="Permalink to “4.10.3 Jenkins配置NodeJS”">​</a></h4><p><img src="'+ws+`" alt=""></p><h4 id="_4-10-4-创建前端流水线项目" tabindex="-1">4.10.4 创建前端流水线项目 <a class="header-anchor" href="#_4-10-4-创建前端流水线项目" aria-label="Permalink to “4.10.4 创建前端流水线项目”">​</a></h4><p>参数化构建分支master<br>过程略...</p><h4 id="_4-10-5-建立jenkinsfile构建脚本" tabindex="-1">4.10.5 建立Jenkinsfile构建脚本 <a class="header-anchor" href="#_4-10-5-建立jenkinsfile构建脚本" aria-label="Permalink to “4.10.5 建立Jenkinsfile构建脚本”">​</a></h4><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">//gitlab的凭证</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">def GIT_AUTH = &quot;6268be95-a137-4dd7-a33b-e46579610285&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">// gitlab的ssh地址</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">def SSH_URL = &#39;ssh://git@192.168.2.136:2222/chen_group/springcloud-front.git&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">node {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">    stage(&#39;拉取代码&#39;) {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">        checkout(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            [</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">$class</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;GitSCM&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">            branches</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: [[</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;*/\${branch}&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]],</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">            doGenerateSubmoduleConfigurations</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">            extensions</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: [],</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">            submoduleCfg</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: [],</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">            userRemoteConfigs</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: [[</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">                credentialsId</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;\${GIT_AUTH}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">                url</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;\${SSH_URL}&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">                ]]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            ]</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">        )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">    stage(&#39;打包,部署网站&#39;) {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">        // 使用NodeJS的npm进行打包</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">        nodejs(&#39;nodejs&#39;){</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">            sh &#39;&#39;&#39;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">                npm install</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">                npm run build</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">            &#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;">&#39;&#39;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">        }</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">        // =====&gt; 以下为远程调用进行项目部署 &lt;=====</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">        sshPublisher(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">            publishers: [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">                sshPublisherDesc(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">                    configName: &quot;prod-server&quot;,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">                    transfers: [sshTransfer(cleanRemote: false,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">                        excludes: </span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;">&#39;&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">                        execCommand: &quot;&quot;,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">                        execTimeout: 120000,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">                        flatten: false,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">                        makeEmptyDirs: false,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">                        noDefaultExcludes: false,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">                        patternSeparator: &#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[, ]</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">+&#39;,</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">                        remoteDirectory</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;/root/docker/nginx/html/&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">                        remoteDirectorySDF</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">false,</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">                        removePrefix</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;dist&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">                        sourceFiles</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;dist/**&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">                        usePty</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">true)],</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">                    usePromotionTimestamp</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">false,</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">                    useWorkspaceInPromotion</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">false,</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">                    verbose</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">false</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">                )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            ]</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">        )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div>`,370),Xs=[Qs];function Ls(Vs,Ks,Ys,Zs,Ws,$s){return a(),i("div",null,Xs)}const ai=s(Is,[["render",Ls]]);export{ii as __pageData,ai as default};
