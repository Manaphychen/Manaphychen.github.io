import{_ as d}from"./chunks/ArticleMetadata.BPSr9oED.js";import{_ as o,E as g,c as y,o as t,j as n,I as p,aj as F,w as k,b as e,e as r,a as C}from"./chunks/framework._AF764y6.js";const z=JSON.parse('{"title":"Linux系统备份与恢复","description":"","frontmatter":{"title":"Linux系统备份与恢复","date":"2023-10-26T22:47:43.000Z","permalink":"/linux/bak/","categories":["运维","Linux"],"tags":["linux"],"author":"Manaphy"},"headers":[],"relativePath":"ops/Linux/13.Linux系统备份与恢复.md","filePath":"ops/Linux/13.Linux系统备份与恢复.md","lastUpdated":1743259133000}'),c={name:"ops/Linux/13.Linux系统备份与恢复.md"},D=n("blockquote",null,[n("p",null,"实体机无法做快照，如果系统出现异常或者数据损坏，后果严重， 要重做系统，还会造成数据丢失。所以我们可以使用备份和恢复技术")],-1),u=n("h1",{id:"dump-备份",tabindex:"-1"},[C("dump 备份 "),n("a",{class:"header-anchor",href:"#dump-备份","aria-label":"Permalink to “dump 备份”"},"​")],-1),b=F(`<blockquote><p>dump 支持分卷和增量备份（所谓增量备份是指备份上次备份后 修改/增加过的文件，也称差异备份）。 注意:不支持备份 xfs 类型 通过dh -Th命令查看</p></blockquote><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># dump命令解析</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">dump</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [-cu] [-123456789] [-f</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">备份后文件名</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">] [-T </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">日期</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">] [目录或文件系统]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">dump</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">	-c</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">							创建新的归档文件，并将由一个或多个文件参数所指定的内容写入归档文件的开头</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">这里的c是指下面的备份层级</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  	-123456789</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  	备份的层级</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 0为最完整备份,会备份所有文件.若指定0以上的层级,则备份至上一次备份以来修改或新增的文件,到9后,可以再次轮替</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  -f</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  						指定备份后文件名</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  -j</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">							调用</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> bzlib</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  库压缩备份文件,也就是将备份后的文件压缩成</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> bz2</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 格式,让文件更小</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  -T</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">							指定开始备份的时间与日期</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  -u</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">							备份完毕后,在/etc/dumpdares</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 中记录备份的文件系统,层级,日期与时间等</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  -t</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">							指定文件名,若该文件已存在备份文件中,则列出名称</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  -W</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">							显示需要备份的文件及其最后一次备份的层级,时间,日期</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  -w</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">							与-W</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 类似,但仅显示需要备份的文件</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 1.将/boot分区所有内容备份到/opt/boot.bak0.bz2  文件中,备份层级为&quot;0&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">dump</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -0uj</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /opt/boot.bak0.bz2</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /boot</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 2.增量备份(在boot分区增加新文件,进行增量备份)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">dump</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -1uj</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /opt/boot.bak1.bz2</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /boot</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 显示需要备份的文件及其最后一次备份的层级,时间,日期</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">dump</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -W</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 查看备份时间文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /etc/dumpdates</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># dump 备份文件或者目录</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">dump</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -0j</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /opt/etc.bak.bz2</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /etc/</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#注意:备份文件或者目录不支持增量备份,即只能使用0级别备份会提示</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">DUMP:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Only</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> level</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> dumps</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> are</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> allowed</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> on</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> subdirectory</span></span></code></pre></div><h1 id="restore-恢复" tabindex="-1">restore 恢复 <a class="header-anchor" href="#restore-恢复" aria-label="Permalink to “restore 恢复”">​</a></h1>`,3),_=F(`<blockquote><p>restore 命令用来恢复已备份的文件，可以从 dump  生成的备份文件中恢复原文件</p></blockquote><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#restore命令解析</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">restore</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">	[模式选项] [选项]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">restore</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -C</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> #使用对比模式,将备份的文件与已存在的文件相互对比</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">restore</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -i</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> #使用交互模式,在进行还原操作时,restors 指令将依序询问用户</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">restore</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -r</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> #进行还原模式</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">restore</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -t</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> #查看模式,看备份文件有哪些文件</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#以上四种模式不能混用,在一次命令中只能指定一种</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">	-f</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&lt;备份设备&gt; </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#从指定的文件中读取备份数据,进行还原操作</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> # restore 命令比较模式,比较备份文件和原文件的区别</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">restore</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -C</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> boot.bak1.bz2</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># restore 命令查看模式,看备份文件有哪些数据/文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">restore</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -t</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> boot.bak0.bz2</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># restore 命令还原模式;如果有增量备份,需要把增量备份也进行恢复,按顺序恢复</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">restore</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -r</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /opt/boot.bak0.bz2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">restore</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -r</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /opt/boot.bak1.bz2</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># restore 命令恢复备份的文件,或者整个目录的文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> restore</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -r</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /opt/etc.bak0.bz2</span></span></code></pre></div>`,2);function m(s,A,B,f,T,x){const l=d,h=g("ClientOnly");return t(),y("div",null,[D,u,p(h,null,{default:k(()=>{var i,a;return[(((i=s.$frontmatter)==null?void 0:i.aside)??!0)&&(((a=s.$frontmatter)==null?void 0:a.showArticleMetadata)??!0)?(t(),e(l,{key:0,article:s.$frontmatter},null,8,["article"])):r("",!0)]}),_:1}),b,p(h,null,{default:k(()=>{var i,a;return[(((i=s.$frontmatter)==null?void 0:i.aside)??!0)&&(((a=s.$frontmatter)==null?void 0:a.showArticleMetadata)??!0)?(t(),e(l,{key:0,article:s.$frontmatter},null,8,["article"])):r("",!0)]}),_:1}),_])}const L=o(c,[["render",m]]);export{z as __pageData,L as default};
