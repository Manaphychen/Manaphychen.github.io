import{_ as g}from"./chunks/ArticleMetadata.BPSr9oED.js";import{_ as F,E as o,c as y,o as a,j as e,I as h,aj as r,w as p,b as k,e as d,a as c}from"./chunks/framework._AF764y6.js";const T=JSON.parse('{"title":"Linux定时任务调度","description":"","frontmatter":{"title":"Linux定时任务调度","date":"2023-10-26T22:19:34.000Z","permalink":"/linux/cron/","categories":["运维","Linux"],"tags":["linux"],"author":"Manaphy"},"headers":[],"relativePath":"ops/Linux/06.Linux定时任务调度.md","filePath":"ops/Linux/06.Linux定时任务调度.md","lastUpdated":1743259619000}'),C={name:"ops/Linux/06.Linux定时任务调度.md"},D=e("h1",{id:"crond-任务调度",tabindex:"-1"},[c("crond 任务调度 "),e("a",{class:"header-anchor",href:"#crond-任务调度","aria-label":"Permalink to “crond 任务调度”"},"​")],-1),A=r(`<blockquote><p>是指系统在某个时间执行的特定的命令或程序。</p></blockquote><p><img src="https://www.pnglog.com/vzHN5P.png" alt="image.png"></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">crontab</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -e</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> #编辑定时任务</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">crontab</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -l</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> #查询定时任务</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">crontab</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -r</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> #删除当前用户所有的定时任务</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">service</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> crond</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> restart</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> #重启任务调度</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">/1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">*</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> date </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> /tmp/mydate </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#每隔一分钟就将当前日期信息追加到mydate</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">0</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> mysqldump</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -u</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -proot</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> testdb</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /home/db.bak</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> #每天凌晨2:00备份数据库</span></span></code></pre></div><p><code>*/1 * * * * ls –l /etc/ &gt; /tmp/to.txt</code></p><p>意思说每分钟执行 ls –l /etc/ &gt; /tmp/to.txt 命令</p><p><strong>5个占位符说明</strong></p><table tabindex="0"><thead><tr><th style="text-align:left;"><strong>项目</strong></th><th style="text-align:left;"><strong>含义</strong></th><th style="text-align:left;"><strong>范围</strong></th></tr></thead><tbody><tr><td style="text-align:left;">第一个 <code>*</code></td><td style="text-align:left;">一小时当中的第几分钟</td><td style="text-align:left;">0-59</td></tr><tr><td style="text-align:left;">第二个 <code>*</code></td><td style="text-align:left;">一天当中的第几小时</td><td style="text-align:left;">0-23</td></tr><tr><td style="text-align:left;">第三个 <code>*</code></td><td style="text-align:left;">一个月当中的第几天</td><td style="text-align:left;">1-31</td></tr><tr><td style="text-align:left;">第四个 <code>*</code></td><td style="text-align:left;">一年当中的第几个月</td><td style="text-align:left;">1-12</td></tr><tr><td style="text-align:left;">第五个 <code>*</code></td><td style="text-align:left;">一周当中的星期几</td><td style="text-align:left;">0-7(0和7都代表星期日)</td></tr></tbody></table><p><strong>特殊符号的说明</strong></p><table tabindex="0"><thead><tr><th style="text-align:left;"><strong>特殊符号</strong></th><th style="text-align:left;"><strong>含义</strong></th></tr></thead><tbody><tr><td style="text-align:left;"><code>*</code></td><td style="text-align:left;">代表任何时间</td></tr><tr><td style="text-align:left;"><code>,</code></td><td style="text-align:left;">代表不连续的时间</td></tr><tr><td style="text-align:left;"><code>-</code></td><td style="text-align:left;">代表连续的时间范围</td></tr><tr><td style="text-align:left;"><code>*/n</code></td><td style="text-align:left;">代表每隔多少时间执行一次</td></tr></tbody></table><p><strong>特殊时间执行案例</strong></p><table tabindex="0"><thead><tr><th style="text-align:left;"><strong>时间</strong></th><th style="text-align:left;"><strong>含义</strong></th></tr></thead><tbody><tr><td style="text-align:left;"><code>45 22 * * * </code></td><td style="text-align:left;">在22点45分执行一次命令</td></tr><tr><td style="text-align:left;"><code>0 17 * * 1 </code></td><td style="text-align:left;">每周一的17点0分</td></tr><tr><td style="text-align:left;"><code>0 5 1,15 * * </code></td><td style="text-align:left;">每月1号和15号的凌晨5点0分</td></tr><tr><td style="text-align:left;"><code>40 4 * * 1-5 </code></td><td style="text-align:left;">每周一到周五的凌晨4点40分</td></tr><tr><td style="text-align:left;"><code>*/10 4 * * * </code></td><td style="text-align:left;">每天的凌晨4点，每隔10分钟执行一次命令</td></tr><tr><td style="text-align:left;"><code>0 0 1,15 * 1 </code></td><td style="text-align:left;">每月1号和15号，每周1的0点0分都会执行命令</td></tr></tbody></table><h1 id="at-定时任务" tabindex="-1">at 定时任务 <a class="header-anchor" href="#at-定时任务" aria-label="Permalink to “at 定时任务”">​</a></h1>`,12),m=r(`<blockquote><p>at 命令是一次性定时计划任务，at 的守护进程 atd 会以后台模式运行，检查作业队列来运行。 默认情况下，atd 守护进程每 60 秒检查作业队列，有作业时，会检查作业运行时间，如果时间与当前时间匹配，则运行此作业。 at 命令是一次性定时计划任务，执行完一个任务后不再执行此任务了 在使用 at 命令的时候，一定要保证 atd 进程的启动</p></blockquote><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#ADBAC7;">!</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">参数说明</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-f	指定包含命令的任务文件</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-q	指定新任务名称</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-l	显示待执行任务的列表</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-d	删除指定的待执行任务</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-m	任务执行后向用户发邮件</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#ADBAC7;">!</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#检测 atd 是否在运行</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[root@Manaphy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]# ps -ef </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">grep</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> atd</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#查看系统中没有执行的工作任务</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[root@Manaphy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]# atq</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#2天后的下午5点执行 ls /home</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">at</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 5pm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> +</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> days</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> #回车</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">at</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">ls</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /home</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> #输入两次ctrl+d 输完后会自动加上&lt;EOT&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">job</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> at</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Mon</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Aug</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 15</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 17:00:00</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2022</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#查看刚刚设置的工作任务(同atq)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[root@Manaphy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]# at -l</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">1</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">       Mon</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Aug</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 15</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 17:00:00</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2022</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> root</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#使用管道符一次性创建任务</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[root@Manaphy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]# echo </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;systemctl restart httpd&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> at</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 23:30</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">job</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> at</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Sat</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Aug</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 13</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 23:30:00</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2022</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 2 分钟后，输出时间到指定文件内</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[root@Manaphy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]# at now +2 minutes</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">at</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">date</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">date.log</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">job</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 3</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> at</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Sat</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Aug</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 13</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 13:48:00</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2022</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">atrm</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> # 删除已经设置的任务 2是编号</span></span></code></pre></div><p><strong>at 时间定义</strong></p><ol><li>接受在当天的 hh:mm(小时:分钟)式的时间指定。假如该时间已过去，那么就放在第二天执行。 例如：04:00</li><li>使用 midnight(深夜)，noon(中午)，teatime(饮茶时间，一般是下午 4 点)等比较模糊的词语来指定时间。</li><li>采用 12 小时计时制，即在时间后面加上 AM（上午）或 PM（下午）来说明是上午还是下午。 例如：12pm</li><li>指定命令执行的具体日期，指定格式为 month day(月 日)或 mm/dd/yy(月/日/年)或 dd.mm.yy(日.月.年)，指定的日期必须跟在指定时间的后面。 例如：04:00 2021-03-1</li><li>使用相对计时法。指定格式为：now + count time-units  ，now 就是当前时间，time-units 是时间单位，这里能够是 minutes(分钟)、hours(小时)、days(天)、weeks(星期)。count 是时间的数量，几天，几小时。 例如：now + 5 minutes</li><li>直接使用 today(今天)、tomorrow(明天)来指定完成命令的时间。</li></ol>`,4);function f(s,u,x,_,b,B){const n=g,l=o("ClientOnly");return a(),y("div",null,[D,h(l,null,{default:p(()=>{var i,t;return[(((i=s.$frontmatter)==null?void 0:i.aside)??!0)&&(((t=s.$frontmatter)==null?void 0:t.showArticleMetadata)??!0)?(a(),k(n,{key:0,article:s.$frontmatter},null,8,["article"])):d("",!0)]}),_:1}),A,h(l,null,{default:p(()=>{var i,t;return[(((i=s.$frontmatter)==null?void 0:i.aside)??!0)&&(((t=s.$frontmatter)==null?void 0:t.showArticleMetadata)??!0)?(a(),k(n,{key:0,article:s.$frontmatter},null,8,["article"])):d("",!0)]}),_:1}),m])}const w=F(C,[["render",f]]);export{T as __pageData,w as default};
