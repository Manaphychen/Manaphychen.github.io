import{_ as s,c as i,o as a,aj as n}from"./chunks/framework._AF764y6.js";const C=JSON.parse('{"title":"Linux系统备份与恢复","description":"","frontmatter":{"title":"Linux系统备份与恢复","date":"2023-10-26T22:47:43.000Z","permalink":"/linux/bak/","categories":["运维","Linux"],"tags":["linux"],"author":"Manaphy"},"headers":[],"relativePath":"ops/Linux/13.Linux系统备份与恢复.md","filePath":"ops/Linux/13.Linux系统备份与恢复.md","lastUpdated":1744977432000}'),t={name:"ops/Linux/13.Linux系统备份与恢复.md"},h=n(`<blockquote><p>实体机无法做快照，如果系统出现异常或者数据损坏，后果严重， 要重做系统，还会造成数据丢失。所以我们可以使用备份和恢复技术</p></blockquote><h1 id="dump-备份" tabindex="-1">dump 备份 <a class="header-anchor" href="#dump-备份" aria-label="Permalink to “dump 备份”">​</a></h1><blockquote><p>dump 支持分卷和增量备份（所谓增量备份是指备份上次备份后 修改/增加过的文件，也称差异备份）。 注意:不支持备份 xfs 类型 通过dh -Th命令查看</p></blockquote><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># dump命令解析</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dump</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [-cu] [-123456789] [-f</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">备份后文件名</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] [-T </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">日期</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] [目录或文件系统]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dump</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	-c</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">							创建新的归档文件，并将由一个或多个文件参数所指定的内容写入归档文件的开头</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">这里的c是指下面的备份层级</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  	-123456789</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  	备份的层级</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 0为最完整备份,会备份所有文件.若指定0以上的层级,则备份至上一次备份以来修改或新增的文件,到9后,可以再次轮替</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  						指定备份后文件名</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  -j</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">							调用</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bzlib</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  库压缩备份文件,也就是将备份后的文件压缩成</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bz2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 格式,让文件更小</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  -T</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">							指定开始备份的时间与日期</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  -u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">							备份完毕后,在/etc/dumpdares</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 中记录备份的文件系统,层级,日期与时间等</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">							指定文件名,若该文件已存在备份文件中,则列出名称</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  -W</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">							显示需要备份的文件及其最后一次备份的层级,时间,日期</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  -w</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">							与-W</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 类似,但仅显示需要备份的文件</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1.将/boot分区所有内容备份到/opt/boot.bak0.bz2  文件中,备份层级为&quot;0&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -0uj</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/boot.bak0.bz2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /boot</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2.增量备份(在boot分区增加新文件,进行增量备份)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -1uj</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/boot.bak1.bz2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /boot</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 显示需要备份的文件及其最后一次备份的层级,时间,日期</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -W</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看备份时间文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/dumpdates</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># dump 备份文件或者目录</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -0j</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/etc.bak.bz2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#注意:备份文件或者目录不支持增量备份,即只能使用0级别备份会提示</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">DUMP:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Only</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> level</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dumps</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> are</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> allowed</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> on</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> subdirectory</span></span></code></pre></div><h1 id="restore-恢复" tabindex="-1">restore 恢复 <a class="header-anchor" href="#restore-恢复" aria-label="Permalink to “restore 恢复”">​</a></h1><blockquote><p>restore 命令用来恢复已备份的文件，可以从 dump  生成的备份文件中恢复原文件</p></blockquote><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#restore命令解析</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">restore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	[模式选项] [选项]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">restore</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -C</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> #使用对比模式,将备份的文件与已存在的文件相互对比</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">restore</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> #使用交互模式,在进行还原操作时,restors 指令将依序询问用户</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">restore</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -r</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> #进行还原模式</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">restore</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> #查看模式,看备份文件有哪些文件</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#以上四种模式不能混用,在一次命令中只能指定一种</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	-f</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;备份设备&gt; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#从指定的文件中读取备份数据,进行还原操作</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # restore 命令比较模式,比较备份文件和原文件的区别</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">restore</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -C</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> boot.bak1.bz2</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># restore 命令查看模式,看备份文件有哪些数据/文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">restore</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> boot.bak0.bz2</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># restore 命令还原模式;如果有增量备份,需要把增量备份也进行恢复,按顺序恢复</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">restore</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -r</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/boot.bak0.bz2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">restore</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -r</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/boot.bak1.bz2</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># restore 命令恢复备份的文件,或者整个目录的文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> restore</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -r</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/etc.bak0.bz2</span></span></code></pre></div>`,7),p=[h];function k(l,e,F,r,d,g){return a(),i("div",null,p)}const o=s(t,[["render",k]]);export{C as __pageData,o as default};
