import{_ as s,c as i,o as t,aj as a}from"./chunks/framework._AF764y6.js";const y=JSON.parse('{"title":"Linux firewalld 防火墙","description":"","frontmatter":{"title":"Linux firewalld 防火墙","date":"2023-10-26T22:25:20.000Z","permalink":"/linux/firewalld/","categories":["运维","Linux"],"tags":["linux"],"author":"Manaphy"},"headers":[],"relativePath":"ops/Linux/09.Linux firewalld 防火墙.md","filePath":"ops/Linux/09.Linux firewalld 防火墙.md","lastUpdated":1743259133000}'),l={name:"ops/Linux/09.Linux firewalld 防火墙.md"},n=a(`<p><strong>firewalld中常用的区域名称及策略规则</strong></p><table tabindex="0"><thead><tr><th style="text-align:left;"><strong>区域</strong></th><th style="text-align:left;"><strong>默认规则策略</strong></th></tr></thead><tbody><tr><td style="text-align:left;">trusted</td><td style="text-align:left;">允许所有的数据包</td></tr><tr><td style="text-align:left;">home</td><td style="text-align:left;">拒绝流入的流量，除非与流出的流量相关；而如果流量与ssh、mdns、ipp-client、smba-client、dhcpv6-client服务相关，则允许流量</td></tr><tr><td style="text-align:left;">internal</td><td style="text-align:left;">等同于home区域</td></tr><tr><td style="text-align:left;">work</td><td style="text-align:left;">拒绝流入的流量，除非与流出的流量相关；而如果流量与ssh、ipp-client与dhcpv6-client服务相关，则允许流量</td></tr><tr><td style="text-align:left;">public</td><td style="text-align:left;">拒绝流入的流量，除非与流出的流量相关；而如果流量与ssh、dhcpv6-client服务相关，则允许流量</td></tr><tr><td style="text-align:left;">external</td><td style="text-align:left;">拒绝流入的流量，除非与流出的流量相关；而如果流量与ssh服务相关，则允许流量</td></tr><tr><td style="text-align:left;">dmz</td><td style="text-align:left;">拒绝流入的流量，除非与流出的流量相关；而如果流量与ssh服务相关，则允许流量</td></tr><tr><td style="text-align:left;">block</td><td style="text-align:left;">拒绝流入的流量，除非与流出的流量相关</td></tr><tr><td style="text-align:left;">drop</td><td style="text-align:left;">拒绝流入的流量，除非与流出的流量相关</td></tr></tbody></table><p><strong>firewall-cmd命令中使用的参数及其作用</strong></p><table tabindex="0"><thead><tr><th style="text-align:left;"><strong>参数</strong></th><th style="text-align:left;"><strong>作用</strong></th></tr></thead><tbody><tr><td style="text-align:left;">--get-default-zone</td><td style="text-align:left;">查询默认的区域名称</td></tr><tr><td style="text-align:left;">--set-default-zone=&lt;区域名称&gt;</td><td style="text-align:left;">设置默认的区域，使其永久生效</td></tr><tr><td style="text-align:left;">--get-zones</td><td style="text-align:left;">显示可用的区域</td></tr><tr><td style="text-align:left;">--get-services</td><td style="text-align:left;">显示预先定义的服务</td></tr><tr><td style="text-align:left;">--get-active-zones</td><td style="text-align:left;">显示当前正在使用的区域与网卡名称</td></tr><tr><td style="text-align:left;">--add-source=</td><td style="text-align:left;">将源自此IP或子网的流量导向指定的区域</td></tr><tr><td style="text-align:left;">--remove-source=</td><td style="text-align:left;">不再将源自此IP或子网的流量导向某个指定区域</td></tr><tr><td style="text-align:left;">--add-interface=&lt;网卡名称&gt;</td><td style="text-align:left;">将源自该网卡的所有流量都导向某个指定区域</td></tr><tr><td style="text-align:left;">--change-interface=&lt;网卡名称&gt;</td><td style="text-align:left;">将某个网卡与区域进行关联</td></tr><tr><td style="text-align:left;">--list-all</td><td style="text-align:left;">显示当前区域的网卡配置参数、资源、端口以及服务等信息</td></tr><tr><td style="text-align:left;">--list-all-zones</td><td style="text-align:left;">显示所有区域的网卡配置参数、资源、端口以及服务等信息</td></tr><tr><td style="text-align:left;">--add-service=&lt;服务名&gt;</td><td style="text-align:left;">设置默认区域允许该服务的流量</td></tr><tr><td style="text-align:left;">--add-port=&lt;端口号/协议&gt;</td><td style="text-align:left;">设置默认区域允许该端口的流量</td></tr><tr><td style="text-align:left;">--remove-service=&lt;服务名&gt;</td><td style="text-align:left;">设置默认区域不再允许该服务的流量</td></tr><tr><td style="text-align:left;">--remove-port=&lt;端口号/协议&gt;</td><td style="text-align:left;">设置默认区域不再允许该端口的流量</td></tr><tr><td style="text-align:left;">--reload</td><td style="text-align:left;">让“永久生效”的配置规则立即生效，并覆盖当前的配置规则</td></tr><tr><td style="text-align:left;">--panic-on</td><td style="text-align:left;">开启应急状况模式</td></tr><tr><td style="text-align:left;">--panic-off</td><td style="text-align:left;">关闭应急状况模式</td></tr></tbody></table><p>与 Linux 系统中其他的防火墙策略配置工具一样，使用 firewalld 配置的防火墙策略默认为运行时（Runtime）模式，又称为当前生效模式，而且会随着系统的重启而失效。如果想让配置策略一直存在，就需要使用永久（Permanent）模式了，方法就是在用 firewall-cmd 命令 正常设置防火墙策略时添加--permanent 参数，这样配置的防火墙策略就可以永久生效了。但是，永久生效模式有一个“不近人情”的特点，就是使用它设置的策略只有在系统重启之后才能自动生效。如果想让配置的策略立即生效，需要手动执行 firewall-cmd --reload 命令。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 查看 firewalld 服务当前所使用的区域</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">firewall-cmd</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --get-default-zone</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 查询指定网卡在firewalld服务中绑定的区域</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">firewall-cmd</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --get-zone-of-interface=ens160</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 把网卡默认区域修改为external,并在系统重启后生效</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">firewall-cmd</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --permanent</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --zone=external</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --change-interface=ens160</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 把firewalld服务的默认区域设置为public(比单独设置网卡权重低)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">firewall-cmd</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --set-default-zone=public</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 启动和关闭firewalld防火墙服务的应急状况模式。(会断开一切网络连接)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">firewall-cmd</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --panic-on</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">firewall-cmd</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --panic-off</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 查询SSH和HTTPS协议的流量是否允许放行。</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">firewall-cmd</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --zone=public</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --query-service=ssh</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">firewall-cmd</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --zone=public</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --query-service=https</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 把HTTPS协议的流量设置为永久允许放行，并立即生效。</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">firewall-cmd</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --permanent</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --zone=public</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --add-service=https</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">firewall-cmd</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --reload</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 把HTTP协议的流量设置为永久拒绝，并立即生效。</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">firewall-cmd</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --permanent</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --zone=public</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --remove-service=http</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">firewall-cmd</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --reload</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 把访问8080和8081端口的流量策略设置为允许，但仅限当前生效</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">firewall-cmd</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --zone=public</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --add-port=8080-8081/tcp</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">firewall-cmd</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --zone=public</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --list-ports</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 把原本访问本机888端口的流量转发到22端口，要且求当前和长期均有效。</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">firewall-cmd</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --permanent</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --zone=public</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --add-forward-port=\\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  port=888:proto=tcp:toport=22:toaddr=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">192.168.10.10</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">firewall-cmd</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --reload</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 配置富贵则,拒绝192.168.10.0/24 网段的所有用户访问本机的 ssh 服务</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">firewall-cmd</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --permanent</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --zone=public</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --add-rich-rule=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;">\\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  rule family=&#39;ipv4&#39; </span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;">\\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  source address=&#39;192.168.10.0/24&#39; </span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;">\\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  service name=&#39;ssh&#39; reject&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">firewall-cmd</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --reload</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 查看防火墙状态 active:说明防火墙是开启状态</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> status</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> firewalld.service</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 关闭防火墙</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> stop</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> firewalld.service</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 永久关闭防火墙</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> disable</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> firewalld.service</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 如果有安装docker,则docker需要重启</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> docker.service</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 开放某端口</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">firewall-cmd</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --zone=public</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --add-port=5672/tcp</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --permanent</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 关闭某端口</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">firewall-cmd</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --zone=public</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --remove-port=5672/tcp</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --permanent</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 配置立即生效</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">firewall-cmd</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --reload</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 查看防火墙所有开放的端口</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">firewall-cmd</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --zone=public</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --list-ports</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 查看监听的端口(centos7默认没有 netstat 命令,需要安装 net-tools 工具)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> net-tools</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">netstat</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -lnpt</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 检查端口被哪个进程占用</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">netstat</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -lnpt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 80</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 查看进程的详细信息</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">ps</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 6832</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 中止进程</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">kill</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -9</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 6832</span></span></code></pre></div>`,8),e=[n];function p(h,k,d,r,g,F){return t(),i("div",null,e)}const C=s(l,[["render",p]]);export{y as __pageData,C as default};
