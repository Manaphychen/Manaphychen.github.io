---
title: Linux定时任务调度
date: 2023-10-26 22:19:34
permalink: /linux/cron/
categories:
  - 运维
  - Linux
tags:
  - linux
author: Manaphy
---
# crond 任务调度
> 是指系统在某个时间执行的特定的命令或程序。

![image.png](https://www.pnglog.com/vzHN5P.png)
```bash
crontab -e #编辑定时任务
crontab -l #查询定时任务
crontab -r #删除当前用户所有的定时任务
service crond restart #重启任务调度
*/1 * * * * date >> /tmp/mydate #每隔一分钟就将当前日期信息追加到mydate
0 2 * * * mysqldump -u root -proot testdb > /home/db.bak #每天凌晨2:00备份数据库
```
`*/1 * * * * ls –l /etc/ > /tmp/to.txt`

意思说每分钟执行 ls –l /etc/ > /tmp/to.txt 命令

**5个占位符说明**

| **项目** | **含义** | **范围** |
| :-- | :-- | :-- |
| 第一个 `*`  | 一小时当中的第几分钟 | 0-59 |
| 第二个 `*` | 一天当中的第几小时 | 0-23 |
| 第三个 `*` | 一个月当中的第几天 | 1-31 |
| 第四个 `*` | 一年当中的第几个月 | 1-12 |
| 第五个 `*` | 一周当中的星期几 | 0-7(0和7都代表星期日) |

**特殊符号的说明**

| **特殊符号** | **含义** |
| :-- | :-- |
| `*` | 代表任何时间 |
| `,` | 代表不连续的时间 |
| `-` | 代表连续的时间范围 |
| `*/n` | 代表每隔多少时间执行一次 |

**特殊时间执行案例**

| **时间** | **含义** |
| :-- | :-- |
| `45 22 * * * ` | 在22点45分执行一次命令 |
| `0 17 * * 1 ` | 每周一的17点0分 |
| `0 5 1,15 * * ` | 每月1号和15号的凌晨5点0分 |
| `40 4 * * 1-5 ` | 每周一到周五的凌晨4点40分 |
| `*/10 4 * * * ` | 每天的凌晨4点，每隔10分钟执行一次命令 |
| `0 0 1,15 * 1 ` | 每月1号和15号，每周1的0点0分都会执行命令 |

# at 定时任务
> at 命令是一次性定时计划任务，at 的守护进程 atd 会以后台模式运行，检查作业队列来运行。
> 默认情况下，atd 守护进程每 60 秒检查作业队列，有作业时，会检查作业运行时间，如果时间与当前时间匹配，则运行此作业。
> at 命令是一次性定时计划任务，执行完一个任务后不再执行此任务了
> 在使用 at 命令的时候，一定要保证 atd 进程的启动

```bash
:<<!
参数说明
-f	指定包含命令的任务文件
-q	指定新任务名称
-l	显示待执行任务的列表
-d	删除指定的待执行任务
-m	任务执行后向用户发邮件
!

#检测 atd 是否在运行
[root@Manaphy ~]# ps -ef |grep atd
#查看系统中没有执行的工作任务
[root@Manaphy ~]# atq

#2天后的下午5点执行 ls /home
at 5pm + 2 days #回车
at> ls /home #输入两次ctrl+d 输完后会自动加上<EOT>
job 1 at Mon Aug 15 17:00:00 2022

#查看刚刚设置的工作任务(同atq)
[root@Manaphy ~]# at -l
1       Mon Aug 15 17:00:00 2022 a root

#使用管道符一次性创建任务
[root@Manaphy ~]# echo "systemctl restart httpd" | at 23:30
job 2 at Sat Aug 13 23:30:00 2022

# 2 分钟后，输出时间到指定文件内
[root@Manaphy ~]# at now +2 minutes
at> date >date.log
job 3 at Sat Aug 13 13:48:00 2022

atrm 2 # 删除已经设置的任务 2是编号
```
**at 时间定义**

1. 接受在当天的 hh:mm(小时:分钟)式的时间指定。假如该时间已过去，那么就放在第二天执行。 例如：04:00
2. 使用 midnight(深夜)，noon(中午)，teatime(饮茶时间，一般是下午 4 点)等比较模糊的词语来指定时间。
3. 采用 12 小时计时制，即在时间后面加上 AM（上午）或 PM（下午）来说明是上午还是下午。 例如：12pm
4. 指定命令执行的具体日期，指定格式为 month day(月 日)或 mm/dd/yy(月/日/年)或 dd.mm.yy(日.月.年)，指定的日期必须跟在指定时间的后面。 例如：04:00 2021-03-1
5. 使用相对计时法。指定格式为：now + count time-units  ，now 就是当前时间，time-units 是时间单位，这里能够是 minutes(分钟)、hours(小时)、days(天)、weeks(星期)。count 是时间的数量，几天，几小时。 例如：now + 5 minutes
6. 直接使用 today(今天)、tomorrow(明天)来指定完成命令的时间。
